<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.18">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2022 Midterms - Explore Midterm Forecasts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./flag.gif" rel="icon" type="image/gif">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-2KH5JZ6JS1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-2KH5JZ6JS1', { 'anonymize_ip': true});
</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <img src="./flag.gif" alt="">
    <span class="navbar-title">2022 Midterms</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./house.html">House</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./senate.html">Senate</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/CoryMcCartan/midterms-22/"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Explore Midterm Forecasts</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell" data-include="false">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="10" data-source-offset="-0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 9;"><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { fmt_pct<span class="op">,</span> rate<span class="op">,</span> fmt_surname<span class="op">,</span> AP<span class="op">,</span> load_image } <span class="im">from</span> <span class="st">"./utils.js"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>d_sum <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"summary.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>distrs <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"house_districts.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"senate_races.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>geom_hex <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"hex.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>geom_states <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"states.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>draws <span class="op">=</span> {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> names <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"draws_cols.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> raw <span class="op">=</span> <span class="cf">await</span> <span class="fu">load_image</span>(<span class="st">"draws.png"</span>)<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> out <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(raw<span class="op">.</span><span class="at">h</span>)<span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n_house <span class="op">=</span> distrs<span class="op">.</span><span class="fu">reduce</span>((accuml<span class="op">,</span> x) <span class="kw">=&gt;</span> accuml <span class="op">+</span> <span class="op">!</span>x<span class="op">.</span><span class="at">unopp</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n_sen <span class="op">=</span> states<span class="op">.</span><span class="fu">reduce</span>((accuml<span class="op">,</span> x) <span class="kw">=&gt;</span> accuml <span class="op">+</span> <span class="op">!</span>x<span class="op">.</span><span class="at">unopp</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> raw<span class="op">.</span><span class="at">h</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> obj <span class="op">=</span> {}</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        obj<span class="op">.</span><span class="at">pred_natl</span> <span class="op">=</span> (raw[i<span class="op">*</span>raw<span class="op">.</span><span class="at">w</span> <span class="op">+</span> <span class="dv">0</span>] <span class="op">+</span> <span class="fl">2.0</span>) <span class="op">/</span> <span class="fl">5.0</span><span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        obj<span class="op">.</span><span class="at">seats_house</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((raw[i<span class="op">*</span>raw<span class="op">.</span><span class="at">w</span> <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="fl">200.0</span>)<span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        obj<span class="op">.</span><span class="at">seats_sen</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((raw[i<span class="op">*</span>raw<span class="op">.</span><span class="at">w</span> <span class="op">+</span> <span class="dv">2</span>] <span class="op">+</span> <span class="fl">1.5</span>) <span class="op">*</span> <span class="fl">25.0</span>)<span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> j <span class="op">&lt;</span> names<span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            obj[names[j]] <span class="op">=</span> raw[i<span class="op">*</span>raw<span class="op">.</span><span class="at">w</span> <span class="op">+</span> j]<span class="op">;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        out[i] <span class="op">=</span> obj<span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>d_distrs <span class="op">=</span> d3<span class="op">.</span><span class="fu">index</span>(distrs<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> at_large <span class="op">=</span> [<span class="st">"AK"</span><span class="op">,</span> <span class="st">"DE"</span><span class="op">,</span> <span class="st">"ND"</span><span class="op">,</span> <span class="st">"SD"</span><span class="op">,</span> <span class="st">"VT"</span><span class="op">,</span> <span class="st">"WY"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">name</span> <span class="op">=</span> AP[d<span class="op">.</span><span class="at">state</span>] <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> (at_large <span class="op">?</span> <span class="st">"At-Large"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">district</span>)<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">name_short</span> <span class="op">=</span> AP[d<span class="op">.</span><span class="at">state</span>] <span class="op">+</span>  (at_large <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="st">" "</span> <span class="op">+</span> d<span class="op">.</span><span class="at">district</span>)<span class="op">;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rcv</span> <span class="op">=</span> [<span class="st">"AK"</span><span class="op">,</span> <span class="st">"ME"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">interval</span> <span class="op">=</span> [d<span class="op">.</span><span class="at">dem_mean</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q10</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q25</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q75</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q90</span><span class="op">,</span> d<span class="op">.</span><span class="at">rcv</span>]<span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rating</span> <span class="op">=</span> <span class="fu">rate</span>(d<span class="op">.</span><span class="at">pr_dem</span>)<span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">dem_mean</span> <span class="op">-</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">dem_cand</span> <span class="op">=</span> <span class="fu">fmt_surname</span>(d<span class="op">.</span><span class="at">dem_cand</span>)<span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rep_cand</span> <span class="op">=</span> <span class="fu">fmt_surname</span>(d<span class="op">.</span><span class="at">rep_cand</span>)<span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">state</span> <span class="op">==</span> <span class="st">"AK"</span>) {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">dem_cand</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">rep_cand</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">cands</span> <span class="op">=</span> [d<span class="op">.</span><span class="at">dem_cand</span><span class="op">,</span> d<span class="op">.</span><span class="at">rep_cand</span><span class="op">,</span> d<span class="op">.</span><span class="at">inc_seat</span>]<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">search</span> <span class="op">=</span> {<span class="dt">dem</span><span class="op">:</span> <span class="st">"incumbent dem. "</span><span class="op">,</span> <span class="dt">open</span><span class="op">:</span> <span class="st">"open seat "</span><span class="op">,</span> <span class="dt">gop</span><span class="op">:</span> <span class="st">"incumbent rep. incumbent gop. "</span>}[d<span class="op">.</span><span class="at">inc_seat</span>] </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> [<span class="st">"contested "</span><span class="op">,</span> <span class="st">"unopposed uncontested "</span>][d<span class="op">.</span><span class="at">unopp</span>]<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span> </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">state</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">district</span>)<span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>d_states <span class="op">=</span> d3<span class="op">.</span><span class="fu">index</span>(states<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">name</span> <span class="op">=</span> AP[d<span class="op">.</span><span class="at">state</span>]<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rcv</span> <span class="op">=</span> [<span class="st">"AK"</span><span class="op">,</span> <span class="st">"ME"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">state</span> <span class="op">==</span> <span class="st">"OK"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">rep_cand</span> <span class="op">==</span> <span class="st">"M. MULLIN"</span>) {</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">state</span> <span class="op">=</span> <span class="st">"OK-S"</span><span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">name</span> <span class="op">+=</span> <span class="st">" Special"</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">interval</span> <span class="op">=</span> [d<span class="op">.</span><span class="at">dem_mean</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q10</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q25</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q75</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q90</span><span class="op">,</span> d<span class="op">.</span><span class="at">rcv</span>]<span class="op">;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rating</span> <span class="op">=</span> <span class="fu">rate</span>(d<span class="op">.</span><span class="at">pr_dem</span>)<span class="op">;</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">dem_mean</span> <span class="op">-</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">dem_cand</span> <span class="op">=</span> <span class="fu">fmt_surname</span>(d<span class="op">.</span><span class="at">dem_cand</span>)<span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rep_cand</span> <span class="op">=</span> <span class="fu">fmt_surname</span>(d<span class="op">.</span><span class="at">rep_cand</span>)<span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">state</span> <span class="op">==</span> <span class="st">"AK"</span>) {</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">dem_cand</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">rep_cand</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">cands</span> <span class="op">=</span> [d<span class="op">.</span><span class="at">dem_cand</span><span class="op">,</span> d<span class="op">.</span><span class="at">rep_cand</span><span class="op">,</span> d<span class="op">.</span><span class="at">inc_seat</span>]<span class="op">;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">search</span> <span class="op">=</span> {<span class="dt">dem</span><span class="op">:</span> <span class="st">"incumbent dem. "</span><span class="op">,</span> <span class="dt">open</span><span class="op">:</span> <span class="st">"open seat "</span><span class="op">,</span> <span class="dt">gop</span><span class="op">:</span> <span class="st">"incumbent rep. incumbent gop. "</span>}[d<span class="op">.</span><span class="at">inc_seat</span>] </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> [<span class="st">"contested "</span><span class="op">,</span> <span class="st">"unopposed uncontested "</span>][d<span class="op">.</span><span class="at">unopp</span>]<span class="op">;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span> </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>DARK_BLUE <span class="op">=</span> <span class="st">"#0063B1"</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>DARK_RED <span class="op">=</span> <span class="st">"#A0442C"</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>BLUE <span class="op">=</span> <span class="st">"#3D77BB"</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>RED <span class="op">=</span> <span class="st">"#B25D4C"</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>w_BODY <span class="op">=</span> <span class="dv">796</span><span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>SMALL <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>elec_date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"2022-11-08"</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> {</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> midpt <span class="op">=</span> <span class="st">"#fafffa"</span><span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> color_dem <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="fl">1.0</span>])</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([midpt<span class="op">,</span> DARK_BLUE])<span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> color_gop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.5</span>])</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([DARK_RED<span class="op">,</span> midpt])<span class="op">;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="kw">=&gt;</span> x <span class="op">&lt;=</span> <span class="fl">0.5</span> <span class="op">?</span> <span class="fu">color_gop</span>(x) <span class="op">:</span> <span class="fu">color_dem</span>(x)<span class="op">;</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">d3</span> <span class="op">=</span> d3<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-19" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="106" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 105;"><span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>viewof text <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">textarea</span>({</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> <span class="vs">`Enter filtering conditions here. For example:</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="vs">    WA-8 win D</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="vs">    DE-AL &lt; 60%</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="vs">    OK-S GOP win</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="vs">    NC senate Dem loss</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="dt">spellcheck</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    <span class="dt">autocomplete</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">autocapitalize</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">resize</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">submit</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">monospace</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="126" data-source-offset="-0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 125;"><span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>db_text <span class="op">=</span> <span class="fu">debounce</span>(viewof text<span class="op">,</span> <span class="dv">300</span>)<span class="op">;</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>constr <span class="op">=</span> {</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lines <span class="op">=</span> db_text<span class="op">.</span><span class="fu">split</span>(<span class="ss">/</span><span class="sc">\r?\n</span><span class="ss">/</span>)</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">trim</span>()<span class="op">.</span><span class="fu">replaceAll</span>(<span class="ss">/</span><span class="sc">\s+</span><span class="ss">/g</span><span class="op">,</span> <span class="st">" "</span>))</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">filter</span>(x <span class="kw">=&gt;</span> x <span class="op">!=</span> <span class="st">""</span>)<span class="op">;</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> regex_race <span class="op">=</span> <span class="ss">/</span><span class="sc">^([A-Z]{2})([- ](\d{1,2}|</span><span class="ss">AL</span><span class="sc">|</span><span class="ss">at</span><span class="sc">[- ]</span><span class="ss">large</span><span class="sc">|</span><span class="ss">S</span><span class="sc">(?</span><span class="ss">!</span><span class="sc">\w)|</span><span class="ss">special</span><span class="sc">|</span><span class="ss">senate</span><span class="sc">|</span><span class="ss">S senate</span><span class="sc">|</span><span class="ss">senate special</span><span class="sc">))?</span><span class="ss">/i</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> races <span class="op">=</span> lines<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> {</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> matches <span class="op">=</span> x<span class="op">.</span><span class="fu">match</span>(regex_race)<span class="op">;</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (matches <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="kw">typeof</span> matches[<span class="dv">3</span>] <span class="op">==</span> <span class="st">"undefined"</span>) <span class="cf">return</span> matches[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (matches[<span class="dv">3</span>]<span class="op">.</span><span class="fu">toLowerCase</span>() <span class="op">==</span> <span class="st">"senate"</span>) <span class="cf">return</span> matches[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="ss">/</span><span class="sc">(</span><span class="ss">AL</span><span class="sc">|</span><span class="ss">at</span><span class="sc">[- ]</span><span class="ss">large</span><span class="sc">)</span><span class="ss">/i</span><span class="op">.</span><span class="fu">test</span>(matches[<span class="dv">3</span>])) matches[<span class="dv">3</span>] <span class="op">=</span> <span class="st">"1"</span><span class="op">;</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="ss">/</span><span class="sc">(</span><span class="ss">S</span><span class="sc">(?</span><span class="ss">!</span><span class="sc">\w)|</span><span class="ss">special</span><span class="sc">|</span><span class="ss">S senate</span><span class="sc">|</span><span class="ss">senate special</span><span class="sc">)</span><span class="ss">/i</span><span class="op">.</span><span class="fu">test</span>(matches[<span class="dv">3</span>])) <span class="cf">return</span> matches[<span class="dv">1</span>] <span class="op">+</span> <span class="st">"-S"</span><span class="op">;</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> matches[<span class="dv">1</span>] <span class="op">+</span> <span class="st">"-"</span> <span class="op">+</span> (<span class="op">+</span>matches[<span class="dv">3</span>])<span class="op">;</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> lower <span class="op">=</span> lines<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> {</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x<span class="op">.</span><span class="fu">replace</span>(<span class="st">"&gt;="</span><span class="op">,</span> <span class="st">"&gt;"</span>)</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">(</span><span class="ss">win </span><span class="sc">(</span><span class="ss">D</span><span class="sc">|</span><span class="ss">dems</span><span class="sc">?)|(</span><span class="ss">D</span><span class="sc">|</span><span class="ss">dems</span><span class="sc">?)</span><span class="ss"> win</span><span class="sc">|(</span><span class="ss">R</span><span class="sc">|</span><span class="ss">GOP</span><span class="sc">|</span><span class="ss">rep</span><span class="sc">)</span><span class="ss"> lose</span><span class="sc">|</span><span class="ss">lose </span><span class="sc">(</span><span class="ss">R</span><span class="sc">|</span><span class="ss">GOP</span><span class="sc">|</span><span class="ss">rep</span><span class="sc">))</span><span class="ss">/i</span><span class="op">,</span> <span class="st">"&gt; 50%"</span>)<span class="op">;</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> matches <span class="op">=</span> x<span class="op">.</span><span class="fu">match</span>(<span class="op">/&gt;</span> <span class="op">?</span>(\d<span class="op">*</span>(<span class="op">?:</span>\<span class="op">.</span>\d<span class="op">+</span>)<span class="op">?%?</span>)<span class="op">/</span>)<span class="op">;</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (matches <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> val <span class="op">=</span> <span class="pp">parseFloat</span>(matches[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (matches[<span class="dv">0</span>]<span class="op">.</span><span class="fu">endsWith</span>(<span class="st">"%"</span>)) val <span class="op">/=</span> <span class="fl">100.0</span><span class="op">;</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> val<span class="op">;</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> upper <span class="op">=</span> lines<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> {</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/&lt;</span><span class="sc">(?</span><span class="ss">!=</span><span class="sc">)</span><span class="ss">/</span><span class="op">,</span> <span class="st">"&lt;="</span>)</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">(</span><span class="ss">win </span><span class="sc">(</span><span class="ss">R</span><span class="sc">|</span><span class="ss">GOP</span><span class="sc">|</span><span class="ss">rep</span><span class="sc">)|(</span><span class="ss">R</span><span class="sc">|</span><span class="ss">GOP</span><span class="sc">|</span><span class="ss">rep</span><span class="sc">)</span><span class="ss"> win</span><span class="sc">|(</span><span class="ss">D</span><span class="sc">|</span><span class="ss">dems</span><span class="sc">?)</span><span class="ss"> los</span><span class="sc">[es]|</span><span class="ss">los</span><span class="sc">[es]</span><span class="ss"> </span><span class="sc">(</span><span class="ss">D</span><span class="sc">|</span><span class="ss"> dems</span><span class="sc">?))</span><span class="ss">/i</span><span class="op">,</span> <span class="st">"&lt;= 49.999%"</span>)<span class="op">;</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> matches <span class="op">=</span> x<span class="op">.</span><span class="fu">match</span>(<span class="ss">/&lt;= </span><span class="sc">?(\d*(?</span><span class="ss">:</span><span class="sc">\.\d+)?</span><span class="ss">%</span><span class="sc">?)</span><span class="ss">/</span>)<span class="op">;</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (matches <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> val <span class="op">=</span> <span class="pp">parseFloat</span>(matches[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (matches[<span class="dv">0</span>]<span class="op">.</span><span class="fu">endsWith</span>(<span class="st">"%"</span>)) val <span class="op">/=</span> <span class="fl">100.0</span><span class="op">;</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> val<span class="op">;</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d3<span class="op">.</span><span class="fu">zip</span>(races<span class="op">,</span> lower<span class="op">,</span> upper)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> { </span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (x[<span class="dv">1</span>] <span class="op">&gt;=</span> x[<span class="dv">2</span>]) x[<span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> { <span class="dt">key</span><span class="op">:</span> x[<span class="dv">0</span>]<span class="op">,</span> <span class="dt">lower</span><span class="op">:</span> x[<span class="dv">1</span>]<span class="op">,</span> <span class="dt">upper</span><span class="op">:</span> x[<span class="dv">2</span>]<span class="op">,</span> }<span class="op">;</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">constr</span> <span class="op">=</span> constr<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="175" data-source-offset="-1851"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 174;"><span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>draws_f <span class="op">=</span> draws<span class="op">.</span><span class="fu">filter</span>(x <span class="kw">=&gt;</span> {</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> c <span class="kw">of</span> constr) {</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (c<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="kw">null</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (x[c<span class="op">.</span><span class="at">key</span>] <span class="op">&lt;=</span> c<span class="op">.</span><span class="at">lower</span> <span class="op">||</span> x[c<span class="op">.</span><span class="at">key</span>] <span class="op">&gt;</span> c<span class="op">.</span><span class="at">upper</span>) <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">draws_f</span> <span class="op">=</span> draws_f<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="184" data-source-offset="-2070"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 183;"><span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>prob_distr <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(d_distrs)<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>([state<span class="op">,</span> v0]) {</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="at">x</span> <span class="op">=</span> v0</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [state<span class="op">,</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(v0)<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>([distr<span class="op">,</span> v1]) {</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> key <span class="op">=</span> state <span class="op">+</span> <span class="st">"-"</span> <span class="op">+</span> (<span class="op">+</span>distr)<span class="op">;</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> prob <span class="op">=</span> d3<span class="op">.</span><span class="fu">mean</span>(draws_f<span class="op">,</span> x <span class="kw">=&gt;</span> x[key] <span class="op">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [<span class="op">+</span>distr<span class="op">,</span> prob]<span class="op">;</span></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>    }))]</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>prob_state <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(d_states)<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>    ([key<span class="op">,</span> _]) <span class="kw">=&gt;</span> [key<span class="op">,</span> d3<span class="op">.</span><span class="fu">mean</span>(draws_f<span class="op">,</span> x <span class="kw">=&gt;</span> x[key] <span class="op">&gt;=</span> <span class="fl">0.5</span>)]</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>))<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-7" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="199" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 198;"><span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> exag_fac <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(width)<span class="op">/</span><span class="dv">80</span><span class="op">;</span></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> last_elec <span class="op">=</span> <span class="dv">222</span><span class="op">;</span></span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> xmin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d_sum<span class="op">.</span><span class="at">house_q10</span><span class="op">*</span>exag_fac<span class="op">,</span> <span class="dv">218</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> xmax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d_sum<span class="op">.</span><span class="at">house_q90</span><span class="op">/</span>exag_fac<span class="op">,</span> <span class="dv">218</span> <span class="op">+</span> <span class="dv">10</span>)<span class="op">,</span> <span class="dv">435</span>)</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> median <span class="op">=</span> d3<span class="op">.</span><span class="fu">median</span>(draws_f<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">seats_house</span>)<span class="op">;</span></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> s_gain <span class="op">=</span> (median <span class="op">&gt;=</span> last_elec <span class="op">?</span> <span class="st">"+"</span> <span class="op">:</span> <span class="st">"-"</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(last_elec <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(median))<span class="op">;</span></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> breaks <span class="op">=</span> <span class="bu">Array</span>(<span class="op">~~</span>((xmax <span class="op">-</span> xmin)<span class="op">/</span><span class="dv">4</span>))<span class="op">.</span><span class="fu">fill</span>()<span class="op">.</span><span class="fu">map</span>((e<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="dv">4</span><span class="op">*</span>i <span class="op">+</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="op">~~</span>xmin)<span class="op">;</span></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">breaks</span><span class="op">=</span>breaks<span class="op">;</span></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> text_shadow <span class="op">=</span> <span class="kw">function</span>(text<span class="op">,</span> opt) {</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> opt2 <span class="op">=</span> {<span class="op">...</span>opt}</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">dx</span> <span class="op">=</span> opt2<span class="op">.</span><span class="at">dx</span> <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">dy</span> <span class="op">=</span> opt2<span class="op">.</span><span class="at">dy</span> <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">fill</span> <span class="op">=</span> <span class="st">"#0007"</span></span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">strokeWidth</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [Plot<span class="op">.</span><span class="fu">text</span>([text]<span class="op">,</span> opt2)<span class="op">,</span> Plot<span class="op">.</span><span class="fu">text</span>([text]<span class="op">,</span> opt)]</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a>        <span class="dt">domain</span><span class="op">:</span> [xmin<span class="op">,</span> xmax]<span class="op">,</span></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>        <span class="dt">round</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clamp</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inset</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>        <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a>        <span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">rectY</span>(draws_f<span class="op">,</span> Plot<span class="op">.</span><span class="fu">binX</span>({<span class="dt">y</span><span class="op">:</span> <span class="st">"count"</span>}<span class="op">,</span> {</span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x</span><span class="op">:</span> <span class="st">"seats_house"</span><span class="op">,</span></span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">seats_house</span> <span class="op">&gt;=</span> <span class="dv">218</span> <span class="op">?</span> BLUE <span class="op">:</span> RED<span class="op">,</span></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>                <span class="dt">inset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>                <span class="dt">thresholds</span><span class="op">:</span> breaks<span class="op">,</span> </span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>            }))<span class="op">,</span></span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>            <span class="dt">dy</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x1</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">quantile</span>(draws_f<span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">seats_house</span>)<span class="op">,</span></span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x2</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">quantile</span>(draws_f<span class="op">,</span> <span class="fl">0.9</span><span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">seats_house</span>)<span class="op">,</span></span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>            <span class="dt">color</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleX</span>([last_elec<span class="op">,</span> median])<span class="op">,</span></span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text_shadow</span>(s_gain<span class="op">,</span> { </span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> median<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">48</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text_shadow</span>(median <span class="op">&gt;=</span> last_elec <span class="op">?</span> <span class="st">"GAIN"</span> <span class="op">:</span> <span class="st">"LOSS"</span><span class="op">,</span> { </span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> median<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">42</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">14</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"← DEM. MAJORITY"</span>]<span class="op">,</span> { </span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="fl">217.5</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="op">-</span><span class="dv">3</span><span class="op">,</span></span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"end"</span><span class="op">,</span></span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#111"</span><span class="op">,</span></span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"REP. MAJORITY →"</span>]<span class="op">,</span> { </span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="fl">217.5</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#111"</span><span class="op">,</span></span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>         Plot<span class="op">.</span><span class="fu">text</span>([last_elec <span class="op">+</span> <span class="st">" LAST ELECTION"</span>]<span class="op">,</span> { </span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> last_elec<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a>         Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"← DEM. HOUSE SEATS"</span>]<span class="op">,</span> { </span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> xmax<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span> <span class="op">-</span> (SMALL <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">0</span>)<span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> width<span class="op">,</span></span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">240</span><span class="op">,</span></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span></span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>        <span class="dt">overflow</span><span class="op">:</span> <span class="st">"visible"</span><span class="op">,</span></span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> plot<span class="op">;</span></span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-hist-house" class="cell-output cell-output-display column-screen">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<div class="banner page-columns page-full">
<div id="summary" class="cell page-columns page-full">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="307" data-source-offset="-0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 306;"><span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>dem_lead <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// d_sum.house_prob &gt; 0.5</span></span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> q50 <span class="op">=</span> d3<span class="op">.</span><span class="fu">median</span>(draws_f<span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">pred_natl</span>)<span class="op">;</span></span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dem_prob_house <span class="op">=</span> d3<span class="op">.</span><span class="fu">mean</span>(draws_f<span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">seats_house</span> <span class="op">&gt;=</span> <span class="dv">218</span>)<span class="op">;</span></span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dem_prob_sen <span class="op">=</span> d3<span class="op">.</span><span class="fu">mean</span>(draws_f<span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">seats_sen</span> <span class="op">&gt;=</span> <span class="dv">50</span>)<span class="op">;</span></span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> win_party <span class="op">=</span> dem_lead <span class="op">?</span> <span class="st">"Democrats"</span> <span class="op">:</span> <span class="st">"Republicans"</span></span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> win_class <span class="op">=</span> dem_lead <span class="op">?</span> <span class="st">"dem"</span> <span class="op">:</span> <span class="st">"rep"</span></span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> pct <span class="op">=</span> <span class="fu">fmt_pct</span>(dem_lead <span class="op">?</span> q50 <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> q50<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> phrase <span class="op">=</span> dem_lead <span class="op">?</span> <span class="st">"controlling"</span> <span class="op">:</span> <span class="st">"flipping"</span></span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob_house <span class="op">=</span> dem_lead <span class="op">?</span> dem_prob_house <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> dem_prob_house</span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob_sen <span class="op">=</span> dem_lead <span class="op">?</span> dem_prob_sen <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> dem_prob_sen</span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span></span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a><span class="vs">Under these conditions, the &lt;b class="</span><span class="sc">${</span>win_class<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>win_party<span class="sc">}</span><span class="vs">&lt;/b&gt; would be expected to win</span></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a><span class="vs">**around </span><span class="sc">${</span>pct<span class="sc">}</span><span class="vs"> of the popular vote**.</span></span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a><span class="vs">They would have a **</span><span class="sc">${</span><span class="fu">fmt_pct</span>(prob_house)<span class="sc">}</span><span class="vs"> chance** of </span><span class="sc">${</span>phrase<span class="sc">}</span><span class="vs"> the House and </span></span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a><span class="vs">a **</span><span class="sc">${</span><span class="fu">fmt_pct</span>(prob_sen)<span class="sc">}</span><span class="vs"> chance** of </span><span class="sc">${</span>phrase<span class="sc">}</span><span class="vs"> the Senate.</span></span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;p class="updated"&gt;</span><span class="sc">${</span>draws_f<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> draws</span></span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span><span class="sc">${</span><span class="fu">fmt_pct</span>(draws_f<span class="op">.</span><span class="at">length</span><span class="op">/</span>draws<span class="op">.</span><span class="at">length</span>)<span class="sc">}</span><span class="vs">) in use.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="cell-output cell-output-display column-screen">
<div id="summary-1">
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="summary-2">
<div id="ojs-cell-5-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="335" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 334;"><span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> exag_fac <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(width)<span class="op">/</span><span class="dv">160</span><span class="op">;</span></span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> last_elec <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> xmin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d_sum<span class="op">.</span><span class="at">sen_q10</span><span class="op">*</span>exag_fac<span class="op">,</span> <span class="dv">50</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> xmax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d_sum<span class="op">.</span><span class="at">sen_q90</span><span class="op">/</span>exag_fac<span class="op">,</span> <span class="dv">50</span> <span class="op">+</span> <span class="dv">10</span>)<span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> median <span class="op">=</span> d3<span class="op">.</span><span class="fu">median</span>(draws_f<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">seats_sen</span>)<span class="op">;</span></span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> s_gain <span class="op">=</span> (median <span class="op">&gt;=</span> last_elec <span class="op">?</span> <span class="st">"+"</span> <span class="op">:</span> <span class="st">"-"</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(last_elec <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(median))<span class="op">;</span></span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> breaks <span class="op">=</span> <span class="bu">Array</span>(<span class="op">~~</span>(xmax <span class="op">-</span> xmin))<span class="op">.</span><span class="fu">fill</span>()<span class="op">.</span><span class="fu">map</span>((e<span class="op">,</span> i) <span class="kw">=&gt;</span> i <span class="op">+</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="op">~~</span>xmin)<span class="op">;</span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> text_shadow <span class="op">=</span> <span class="kw">function</span>(text<span class="op">,</span> opt) {</span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> opt2 <span class="op">=</span> {<span class="op">...</span>opt}</span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">dx</span> <span class="op">=</span> opt2<span class="op">.</span><span class="at">dx</span> <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">dy</span> <span class="op">=</span> opt2<span class="op">.</span><span class="at">dy</span> <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">fill</span> <span class="op">=</span> <span class="st">"#0007"</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">strokeWidth</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [Plot<span class="op">.</span><span class="fu">text</span>([text]<span class="op">,</span> opt2)<span class="op">,</span> Plot<span class="op">.</span><span class="fu">text</span>([text]<span class="op">,</span> opt)]</span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>        <span class="dt">domain</span><span class="op">:</span> [xmin<span class="op">,</span> xmax]<span class="op">,</span></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clamp</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inset</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>        <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>        <span class="dt">axis</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span></span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>        <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>        <span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insetBottom</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">rectY</span>(draws_f<span class="op">,</span> Plot<span class="op">.</span><span class="fu">binX</span>({</span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a>                <span class="dt">y</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="op">-</span>x<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span> {</span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x</span><span class="op">:</span> <span class="st">"seats_sen"</span><span class="op">,</span></span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">seats_sen</span> <span class="op">&gt;=</span> <span class="dv">50</span> <span class="op">?</span> BLUE <span class="op">:</span> RED<span class="op">,</span></span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a>                <span class="dt">thresholds</span><span class="op">:</span> breaks<span class="op">,</span> </span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a>            }))<span class="op">,</span></span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {</span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a>            <span class="dt">dy</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x1</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">quantile</span>(draws_f<span class="op">,</span> <span class="fl">0.1</span><span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">seats_sen</span>)<span class="op">,</span></span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x2</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">quantile</span>(draws_f<span class="op">,</span> <span class="fl">0.9</span><span class="op">,</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">seats_sen</span>)<span class="op">,</span></span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>            <span class="dt">color</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleX</span>([last_elec<span class="op">,</span> median])<span class="op">,</span></span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text_shadow</span>(s_gain<span class="op">,</span> { </span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> median<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">48</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span></span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text_shadow</span>(median <span class="op">&gt;=</span> last_elec <span class="op">?</span> <span class="st">"GAIN"</span> <span class="op">:</span> <span class="st">"LOSS"</span><span class="op">,</span> { </span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> median<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">42</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">14</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"← DEM. MAJORITY"</span>]<span class="op">,</span> { </span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="fl">49.5</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="op">-</span><span class="dv">3</span><span class="op">,</span></span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"end"</span><span class="op">,</span></span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#111"</span><span class="op">,</span></span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"REP. MAJORITY →"</span>]<span class="op">,</span> { </span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="fl">49.5</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#111"</span><span class="op">,</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a>         Plot<span class="op">.</span><span class="fu">text</span>([last_elec <span class="op">+</span> <span class="st">" LAST ELECTION"</span>]<span class="op">,</span> { </span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> last_elec<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a>         Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"← DEM. SENATE SEATS"</span>]<span class="op">,</span> { </span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> xmax<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="dv">4</span> <span class="op">+</span> (SMALL <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">0</span>)<span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> width<span class="op">,</span></span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">240</span><span class="op">,</span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">overflow</span><span class="op">:</span> <span class="st">"visible"</span><span class="op">,</span></span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> plot<span class="op">;</span></span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-hist-sen" class="cell-output cell-output-display column-screen">
<div id="ojs-cell-6" data-nodetype="expression">

</div>
</div>
</div>
<section id="house-and-senate-maps" class="level1 page-columns page-full">
<h1>House and Senate Maps</h1>
<div class="column-screen-inset quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="441" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 440;"><span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>house_map <span class="op">=</span> {</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> distrs <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(geom_hex<span class="op">,</span> geom_hex<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">foo</span>)<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">match</span> <span class="op">=</span> d_distrs<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">state</span>)<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">district</span>)<span class="op">;</span></span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">flip</span> <span class="op">=</span> ((d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span> <span class="op">==</span> <span class="st">"gop"</span>) </span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a>                <span class="op">||</span> (d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span> <span class="op">==</span> <span class="st">"dem"</span>))</span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;&amp;</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">&gt;</span> <span class="fl">0.01</span>)<span class="op">;</span></span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> w <span class="op">=</span> <span class="dv">960</span><span class="op">;</span></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> h <span class="op">=</span> w <span class="op">*</span> <span class="fl">0.72</span><span class="op">;</span></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> GOLD <span class="op">=</span> <span class="st">"#bc1"</span><span class="op">;</span></span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"auto"</span>)<span class="op">;</span></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> proj <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoAlbers</span>()</span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scale</span>(<span class="fl">0.92</span><span class="op">*</span>w)</span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="fl">0.97</span><span class="op">*</span>w<span class="op">/</span><span class="dv">2</span><span class="op">,</span> <span class="fl">0.94</span><span class="op">*</span>h<span class="op">/</span><span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(proj)<span class="op">;</span></span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geom_distrs <span class="op">=</span> svg</span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"distrs"</span>)</span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(distrs)</span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#fff"</span>)</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#111"</span>)</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span>)</span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geom_distrs_hover <span class="op">=</span> svg</span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"distrs"</span>)</span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(distrs)</span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">flip</span> <span class="op">?</span> <span class="st">"url(#diagonalHatch)"</span> <span class="op">:</span> <span class="st">"none"</span>)</span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.0</span>)</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span>    </span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> tt <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#plot-house-map"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"map-tooltip"</span>)</span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> prob_table<span class="op">;</span></span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> mmv <span class="op">=</span> <span class="kw">function</span>(e<span class="op">,</span> d) {</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> [mx<span class="op">,</span> my] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(e)<span class="op">;</span></span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> svg_dim <span class="op">=</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">;</span></span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> w_fac <span class="op">=</span> svg_dim<span class="op">.</span><span class="at">width</span><span class="op">/</span>w<span class="op">;</span></span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mx <span class="op">&lt;</span> <span class="dv">50</span><span class="op">/</span>w_fac) mx <span class="op">=</span> <span class="dv">50</span><span class="op">/</span>w_fac<span class="op">;</span></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mx <span class="op">&gt;</span> w <span class="op">-</span> <span class="dv">190</span><span class="op">/</span>w_fac) mx <span class="op">=</span> w <span class="op">-</span> <span class="dv">190</span><span class="op">/</span>w_fac<span class="op">;</span></span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob <span class="op">=</span> prob_table[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">state</span>][d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">district</span>]<span class="op">;</span></span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cand<span class="op">;</span></span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> miss<span class="op">;</span></span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prob <span class="op">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a>        cand <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span> <span class="op">?</span> <span class="st">"Democrats"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span><span class="op">;</span></span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>        miss <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span><span class="op">;</span></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>        cand <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span> <span class="op">?</span> <span class="st">"Republicans"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span><span class="op">;</span></span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a>        miss <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span><span class="op">;</span></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> inc <span class="op">=</span> {</span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dem</span><span class="op">:</span> <span class="vs">`&lt;b style='color: </span><span class="sc">${</span>DARK_BLUE<span class="sc">}</span><span class="vs">'&gt;Dem.&lt;/b&gt; incumbent`</span><span class="op">,</span></span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gop</span><span class="op">:</span> <span class="vs">`&lt;b style='color: </span><span class="sc">${</span>DARK_RED<span class="sc">}</span><span class="vs">'&gt;Rep.&lt;/b&gt; incumbent`</span><span class="op">,</span></span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a>        <span class="dt">open</span><span class="op">:</span> <span class="st">"&lt;b&gt;Open&lt;/b&gt; seat"</span><span class="op">,</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a>    }[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span>]</span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob_text<span class="op">;</span></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob_color <span class="op">=</span> prob <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> DARK_BLUE <span class="op">:</span> DARK_RED<span class="op">;</span></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">unopp</span> <span class="op">==</span> <span class="dv">1</span>) {</span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>        prob_text <span class="op">=</span> <span class="vs">`&lt;b style="color: </span><span class="sc">${</span>prob_color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>cand<span class="sc">}</span><span class="vs">&lt;/b&gt;</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span>miss <span class="op">?</span> <span class="st">"are"</span> <span class="op">:</span> <span class="st">"is"</span><span class="sc">}</span><span class="vs"> running unopposed and will win the seat.`</span></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>        prob_text <span class="op">=</span> <span class="vs">`&lt;b style="color: </span><span class="sc">${</span>prob_color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>cand<span class="sc">}</span><span class="vs">&lt;/b&gt; </span></span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a><span class="vs">            would have a </span></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;b&gt;</span><span class="sc">${</span><span class="fu">fmt_pct</span>(prob <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> prob <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> prob)<span class="sc">}</span><span class="vs">&lt;/b&gt; chance of winning.`</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> disclaimer <span class="op">=</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rcv</span> <span class="op">?</span> <span class="vs">`&lt;p style="color: #777; font-size: 0.75em; font-style: italic; margin-top: 0.5em;"&gt;</span></span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a><span class="vs">        Estimates do not account for rank-choice voting.</span></span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/p&gt;`</span> <span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.4</span>)<span class="op">;</span></span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> txt <span class="op">=</span> <span class="vs">`&lt;h3&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;</span></span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span>inc<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="width: 100%; height: 1rem; margin: 4px 0; display: flex;"&gt;</span></span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="background: </span><span class="sc">${</span>BLUE<span class="sc">}</span><span class="vs">; flex-basis: </span><span class="sc">${</span><span class="dv">100</span><span class="op">*</span>prob<span class="sc">}</span><span class="vs">%"&gt;&lt;/div&gt;</span></span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="background: </span><span class="sc">${</span>RED<span class="sc">}</span><span class="vs">; flex-basis: </span><span class="sc">${</span><span class="dv">100</span> <span class="op">-</span> <span class="dv">100</span><span class="op">*</span>prob<span class="sc">}</span><span class="vs">%"&gt;&lt;/div&gt;</span></span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span>prob_text<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span>disclaimer<span class="sc">}</span></span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span><span class="op">;</span></span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a>    tt<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>)</span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(txt)</span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (mx <span class="op">-</span> <span class="dv">50</span>)<span class="op">*</span>svg_dim<span class="op">.</span><span class="at">width</span><span class="op">/</span>w <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"bottom"</span><span class="op">,</span> (h <span class="op">-</span> my <span class="op">+</span> <span class="dv">25</span>)<span class="op">*</span>svg_dim<span class="op">.</span><span class="at">height</span><span class="op">/</span>h <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> mout <span class="op">=</span> <span class="kw">function</span>(d) {</span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a>    geom_distrs_hover<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.0</span>)<span class="op">;</span></span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a>    tt<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a>geom_distrs_hover<span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> mmv)<span class="op">;</span></span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a>geom_distrs_hover<span class="op">.</span><span class="fu">on</span>(<span class="st">"touchmove"</span><span class="op">,</span> mmv)<span class="op">;</span></span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> mout)<span class="op">;</span></span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"touchend"</span><span class="op">,</span> mout)<span class="op">;</span></span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> node <span class="op">=</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a><span class="bu">Object</span><span class="op">.</span><span class="fu">defineProperty</span>(node<span class="op">,</span> <span class="st">"value"</span><span class="op">,</span> {</span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>() {</span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> draws<span class="op">;</span></span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb9-560"><a href="#cb9-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set</span>(v) {</span>
<span id="cb9-561"><a href="#cb9-561" aria-hidden="true" tabindex="-1"></a>        prob_table <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb9-562"><a href="#cb9-562" aria-hidden="true" tabindex="-1"></a>        geom_distrs<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb9-563"><a href="#cb9-563" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">color</span>(prob_table[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">state</span>][d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">district</span>])<span class="op">;</span></span>
<span id="cb9-564"><a href="#cb9-564" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb9-565"><a href="#cb9-565" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-566"><a href="#cb9-566" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb9-567"><a href="#cb9-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-568"><a href="#cb9-568" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb9-569"><a href="#cb9-569" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-house-map" class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="574" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 573;"><span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a>sen_map <span class="op">=</span> {</span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> states <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(geom_states<span class="op">,</span> geom_states<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">foo</span>)<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">match</span> <span class="op">=</span> d_states<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> d<span class="op">.</span><span class="at">match</span> <span class="op">==</span> <span class="st">"undefined"</span>) {</span>
<span id="cb10-578"><a href="#cb10-578" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">flip</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb10-579"><a href="#cb10-579" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">match</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-581"><a href="#cb10-581" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">flip</span> <span class="op">=</span> ((d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span> <span class="op">==</span> <span class="st">"gop"</span>) </span>
<span id="cb10-582"><a href="#cb10-582" aria-hidden="true" tabindex="-1"></a>                    <span class="op">||</span> (d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span> <span class="op">==</span> <span class="st">"dem"</span>))</span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;&amp;</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">&gt;</span> <span class="fl">0.01</span>)<span class="op">;</span></span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-585"><a href="#cb10-585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb10-586"><a href="#cb10-586" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-588"><a href="#cb10-588" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> w <span class="op">=</span> <span class="dv">960</span><span class="op">;</span></span>
<span id="cb10-589"><a href="#cb10-589" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> h <span class="op">=</span> w <span class="op">*</span> <span class="fl">0.70</span><span class="op">;</span></span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> GOLD <span class="op">=</span> <span class="st">"#bc1"</span><span class="op">;</span></span>
<span id="cb10-591"><a href="#cb10-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-592"><a href="#cb10-592" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb10-593"><a href="#cb10-593" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb10-594"><a href="#cb10-594" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb10-595"><a href="#cb10-595" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb10-596"><a href="#cb10-596" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"auto"</span>)<span class="op">;</span></span>
<span id="cb10-597"><a href="#cb10-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-598"><a href="#cb10-598" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> proj <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoAlbers</span>()</span>
<span id="cb10-599"><a href="#cb10-599" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scale</span>(<span class="fl">1.40</span><span class="op">*</span>w)</span>
<span id="cb10-600"><a href="#cb10-600" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="fl">0.78</span><span class="op">*</span>w<span class="op">/</span><span class="dv">2</span><span class="op">,</span> <span class="fl">0.14</span><span class="op">*</span>h<span class="op">/</span><span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb10-601"><a href="#cb10-601" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(proj)<span class="op">;</span></span>
<span id="cb10-602"><a href="#cb10-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-603"><a href="#cb10-603" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geom_distrs <span class="op">=</span> svg</span>
<span id="cb10-604"><a href="#cb10-604" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-605"><a href="#cb10-605" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"distrs"</span>)</span>
<span id="cb10-606"><a href="#cb10-606" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb10-607"><a href="#cb10-607" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(states)</span>
<span id="cb10-608"><a href="#cb10-608" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb10-609"><a href="#cb10-609" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#fff"</span>)</span>
<span id="cb10-610"><a href="#cb10-610" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#111"</span>)</span>
<span id="cb10-611"><a href="#cb10-611" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span>)</span>
<span id="cb10-612"><a href="#cb10-612" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb10-613"><a href="#cb10-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-614"><a href="#cb10-614" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geom_distrs_hover <span class="op">=</span> svg</span>
<span id="cb10-615"><a href="#cb10-615" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-616"><a href="#cb10-616" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"distrs"</span>)</span>
<span id="cb10-617"><a href="#cb10-617" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb10-618"><a href="#cb10-618" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(states)</span>
<span id="cb10-619"><a href="#cb10-619" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb10-620"><a href="#cb10-620" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">flip</span> <span class="op">?</span> <span class="st">"url(#diagonalHatch)"</span> <span class="op">:</span> <span class="st">"none"</span>)</span>
<span id="cb10-621"><a href="#cb10-621" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb10-622"><a href="#cb10-622" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.0</span>)</span>
<span id="cb10-623"><a href="#cb10-623" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span>    </span>
<span id="cb10-624"><a href="#cb10-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-625"><a href="#cb10-625" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> tt <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#plot-sen-map"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb10-626"><a href="#cb10-626" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"map-tooltip"</span>)</span>
<span id="cb10-627"><a href="#cb10-627" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb10-628"><a href="#cb10-628" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> prob_table<span class="op">;</span></span>
<span id="cb10-629"><a href="#cb10-629" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-630"><a href="#cb10-630" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> mmv <span class="op">=</span> <span class="kw">function</span>(e<span class="op">,</span> d) {</span>
<span id="cb10-631"><a href="#cb10-631" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> [mx<span class="op">,</span> my] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(e)<span class="op">;</span></span>
<span id="cb10-632"><a href="#cb10-632" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> svg_dim <span class="op">=</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">;</span></span>
<span id="cb10-633"><a href="#cb10-633" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> w_fac <span class="op">=</span> svg_dim<span class="op">.</span><span class="at">width</span><span class="op">/</span>w<span class="op">;</span></span>
<span id="cb10-634"><a href="#cb10-634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mx <span class="op">&lt;</span> <span class="dv">50</span><span class="op">/</span>w_fac) mx <span class="op">=</span> <span class="dv">50</span><span class="op">/</span>w_fac<span class="op">;</span></span>
<span id="cb10-635"><a href="#cb10-635" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mx <span class="op">&gt;</span> w <span class="op">-</span> <span class="dv">190</span><span class="op">/</span>w_fac) mx <span class="op">=</span> w <span class="op">-</span> <span class="dv">190</span><span class="op">/</span>w_fac<span class="op">;</span></span>
<span id="cb10-636"><a href="#cb10-636" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-637"><a href="#cb10-637" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.4</span>)<span class="op">;</span></span>
<span id="cb10-638"><a href="#cb10-638" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-639"><a href="#cb10-639" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> txt<span class="op">;</span></span>
<span id="cb10-640"><a href="#cb10-640" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">match</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb10-641"><a href="#cb10-641" aria-hidden="true" tabindex="-1"></a>        txt <span class="op">=</span> <span class="vs">`&lt;h3&gt;</span><span class="sc">${</span>AP[d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">state</span>]<span class="sc">}</span><span class="vs">&lt;/h3&gt;&lt;p&gt;&lt;/p&gt;</span></span>
<span id="cb10-642"><a href="#cb10-642" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;p&gt;No election this year.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb10-643"><a href="#cb10-643" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-644"><a href="#cb10-644" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> prob <span class="op">=</span> prob_table[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">state</span>]<span class="op">;</span></span>
<span id="cb10-645"><a href="#cb10-645" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> cand<span class="op">;</span></span>
<span id="cb10-646"><a href="#cb10-646" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> miss<span class="op">;</span></span>
<span id="cb10-647"><a href="#cb10-647" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (prob <span class="op">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb10-648"><a href="#cb10-648" aria-hidden="true" tabindex="-1"></a>            cand <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span> <span class="op">?</span> <span class="st">"Democrats"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span><span class="op">;</span></span>
<span id="cb10-649"><a href="#cb10-649" aria-hidden="true" tabindex="-1"></a>            miss <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span><span class="op">;</span></span>
<span id="cb10-650"><a href="#cb10-650" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb10-651"><a href="#cb10-651" aria-hidden="true" tabindex="-1"></a>            cand <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span> <span class="op">?</span> <span class="st">"Republicans"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span><span class="op">;</span></span>
<span id="cb10-652"><a href="#cb10-652" aria-hidden="true" tabindex="-1"></a>            miss <span class="op">=</span> <span class="op">!</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span><span class="op">;</span></span>
<span id="cb10-653"><a href="#cb10-653" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-654"><a href="#cb10-654" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> inc <span class="op">=</span> {</span>
<span id="cb10-655"><a href="#cb10-655" aria-hidden="true" tabindex="-1"></a>            <span class="dt">dem</span><span class="op">:</span> <span class="vs">`&lt;b style='color: </span><span class="sc">${</span>DARK_BLUE<span class="sc">}</span><span class="vs">'&gt;Dem.&lt;/b&gt; incumbent`</span><span class="op">,</span></span>
<span id="cb10-656"><a href="#cb10-656" aria-hidden="true" tabindex="-1"></a>            <span class="dt">gop</span><span class="op">:</span> <span class="vs">`&lt;b style='color: </span><span class="sc">${</span>DARK_RED<span class="sc">}</span><span class="vs">'&gt;Rep.&lt;/b&gt; incumbent`</span><span class="op">,</span></span>
<span id="cb10-657"><a href="#cb10-657" aria-hidden="true" tabindex="-1"></a>            <span class="dt">open</span><span class="op">:</span> <span class="st">"&lt;b&gt;Open&lt;/b&gt; seat"</span><span class="op">,</span></span>
<span id="cb10-658"><a href="#cb10-658" aria-hidden="true" tabindex="-1"></a>        }[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span>]</span>
<span id="cb10-659"><a href="#cb10-659" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> prob_text<span class="op">;</span></span>
<span id="cb10-660"><a href="#cb10-660" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> prob_color <span class="op">=</span> prob <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> DARK_BLUE <span class="op">:</span> DARK_RED<span class="op">;</span></span>
<span id="cb10-661"><a href="#cb10-661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">unopp</span> <span class="op">==</span> <span class="dv">1</span>) {</span>
<span id="cb10-662"><a href="#cb10-662" aria-hidden="true" tabindex="-1"></a>            prob_text <span class="op">=</span> <span class="vs">`&lt;b style="color: </span><span class="sc">${</span>prob_color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>cand<span class="sc">}</span><span class="vs">&lt;/b&gt;</span></span>
<span id="cb10-663"><a href="#cb10-663" aria-hidden="true" tabindex="-1"></a><span class="vs">                </span><span class="sc">${</span>miss <span class="op">?</span> <span class="st">"are"</span> <span class="op">:</span> <span class="st">"is"</span><span class="sc">}</span><span class="vs"> running unopposed and will win the seat.`</span></span>
<span id="cb10-664"><a href="#cb10-664" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb10-665"><a href="#cb10-665" aria-hidden="true" tabindex="-1"></a>            prob_text <span class="op">=</span> <span class="vs">`&lt;b style="color: </span><span class="sc">${</span>prob_color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>cand<span class="sc">}</span><span class="vs">&lt;/b&gt; </span></span>
<span id="cb10-666"><a href="#cb10-666" aria-hidden="true" tabindex="-1"></a><span class="vs">                would have a </span></span>
<span id="cb10-667"><a href="#cb10-667" aria-hidden="true" tabindex="-1"></a><span class="vs">                &lt;b&gt;</span><span class="sc">${</span><span class="fu">fmt_pct</span>(prob <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> prob <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> prob)<span class="sc">}</span><span class="vs">&lt;/b&gt; chance of winning.`</span></span>
<span id="cb10-668"><a href="#cb10-668" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-669"><a href="#cb10-669" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> disclaimer <span class="op">=</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rcv</span> <span class="op">?</span> <span class="vs">`&lt;p style="color: #777; font-size: 0.75em; font-style: italic; margin-top: 0.5em;"&gt;</span></span>
<span id="cb10-670"><a href="#cb10-670" aria-hidden="true" tabindex="-1"></a><span class="vs">            Estimates do not account for rank-choice voting.</span></span>
<span id="cb10-671"><a href="#cb10-671" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/p&gt;`</span> <span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb10-672"><a href="#cb10-672" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-673"><a href="#cb10-673" aria-hidden="true" tabindex="-1"></a>        txt <span class="op">=</span> <span class="vs">`&lt;h3&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;</span></span>
<span id="cb10-674"><a href="#cb10-674" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;p&gt;</span><span class="sc">${</span>inc<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb10-675"><a href="#cb10-675" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div style="width: 100%; height: 1rem; margin: 4px 0; display: flex;"&gt;</span></span>
<span id="cb10-676"><a href="#cb10-676" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div style="background: </span><span class="sc">${</span>BLUE<span class="sc">}</span><span class="vs">; flex-basis: </span><span class="sc">${</span><span class="dv">100</span><span class="op">*</span>prob<span class="sc">}</span><span class="vs">%"&gt;&lt;/div&gt;</span></span>
<span id="cb10-677"><a href="#cb10-677" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div style="background: </span><span class="sc">${</span>RED<span class="sc">}</span><span class="vs">; flex-basis: </span><span class="sc">${</span><span class="dv">100</span> <span class="op">-</span> <span class="dv">100</span><span class="op">*</span>prob<span class="sc">}</span><span class="vs">%"&gt;&lt;/div&gt;</span></span>
<span id="cb10-678"><a href="#cb10-678" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/div&gt;</span></span>
<span id="cb10-679"><a href="#cb10-679" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;p&gt;</span><span class="sc">${</span>prob_text<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb10-680"><a href="#cb10-680" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span>disclaimer<span class="sc">}</span></span>
<span id="cb10-681"><a href="#cb10-681" aria-hidden="true" tabindex="-1"></a><span class="vs">            `</span><span class="op">;</span></span>
<span id="cb10-682"><a href="#cb10-682" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-683"><a href="#cb10-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-684"><a href="#cb10-684" aria-hidden="true" tabindex="-1"></a>    tt<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>)</span>
<span id="cb10-685"><a href="#cb10-685" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(txt)</span>
<span id="cb10-686"><a href="#cb10-686" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (mx <span class="op">-</span> <span class="dv">50</span>)<span class="op">*</span>svg_dim<span class="op">.</span><span class="at">width</span><span class="op">/</span>w <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb10-687"><a href="#cb10-687" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"bottom"</span><span class="op">,</span> (h <span class="op">-</span> my <span class="op">+</span> <span class="dv">25</span>)<span class="op">*</span>svg_dim<span class="op">.</span><span class="at">height</span><span class="op">/</span>h <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb10-688"><a href="#cb10-688" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-689"><a href="#cb10-689" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> mout <span class="op">=</span> <span class="kw">function</span>(d) {</span>
<span id="cb10-690"><a href="#cb10-690" aria-hidden="true" tabindex="-1"></a>    geom_distrs_hover<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.0</span>)<span class="op">;</span></span>
<span id="cb10-691"><a href="#cb10-691" aria-hidden="true" tabindex="-1"></a>    tt<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb10-692"><a href="#cb10-692" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-693"><a href="#cb10-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-694"><a href="#cb10-694" aria-hidden="true" tabindex="-1"></a>geom_distrs_hover<span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> mmv)<span class="op">;</span></span>
<span id="cb10-695"><a href="#cb10-695" aria-hidden="true" tabindex="-1"></a>geom_distrs_hover<span class="op">.</span><span class="fu">on</span>(<span class="st">"touchmove"</span><span class="op">,</span> mmv)<span class="op">;</span></span>
<span id="cb10-696"><a href="#cb10-696" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> mout)<span class="op">;</span></span>
<span id="cb10-697"><a href="#cb10-697" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"touchend"</span><span class="op">,</span> mout)<span class="op">;</span></span>
<span id="cb10-698"><a href="#cb10-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-699"><a href="#cb10-699" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> node <span class="op">=</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb10-700"><a href="#cb10-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-701"><a href="#cb10-701" aria-hidden="true" tabindex="-1"></a><span class="bu">Object</span><span class="op">.</span><span class="fu">defineProperty</span>(node<span class="op">,</span> <span class="st">"value"</span><span class="op">,</span> {</span>
<span id="cb10-702"><a href="#cb10-702" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>() {</span>
<span id="cb10-703"><a href="#cb10-703" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> draws<span class="op">;</span></span>
<span id="cb10-704"><a href="#cb10-704" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb10-705"><a href="#cb10-705" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set</span>(v) {</span>
<span id="cb10-706"><a href="#cb10-706" aria-hidden="true" tabindex="-1"></a>        prob_table <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb10-707"><a href="#cb10-707" aria-hidden="true" tabindex="-1"></a>        geom_distrs<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb10-708"><a href="#cb10-708" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (d<span class="op">.</span><span class="at">match</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb10-709"><a href="#cb10-709" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="st">"#c0c0c0"</span><span class="op">;</span></span>
<span id="cb10-710"><a href="#cb10-710" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb10-711"><a href="#cb10-711" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="fu">color</span>(prob_table[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">state</span>])<span class="op">;</span></span>
<span id="cb10-712"><a href="#cb10-712" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-713"><a href="#cb10-713" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb10-714"><a href="#cb10-714" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-715"><a href="#cb10-715" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb10-716"><a href="#cb10-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-717"><a href="#cb10-717" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> node<span class="op">;</span></span>
<span id="cb10-718"><a href="#cb10-718" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-sen-map" class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<div class="cell" data-include="false">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="725" data-source-offset="-0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 724;"><span id="cb11-725"><a href="#cb11-725" aria-hidden="true" tabindex="-1"></a>house_map<span class="op">.</span><span class="at">value</span> <span class="op">=</span> prob_distr<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-9-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="726" data-source-offset="-30"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 725;"><span id="cb12-726"><a href="#cb12-726" aria-hidden="true" tabindex="-1"></a>sen_map<span class="op">.</span><span class="at">value</span> <span class="op">=</span> prob_state<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-9-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="728" data-source-offset="-59"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 727;"><span id="cb13-728"><a href="#cb13-728" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">debounce</span>(input<span class="op">,</span> delay <span class="op">=</span> <span class="dv">1000</span>) {</span>
<span id="cb13-729"><a href="#cb13-729" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Generators<span class="op">.</span><span class="fu">observe</span>(notify <span class="kw">=&gt;</span> {</span>
<span id="cb13-730"><a href="#cb13-730" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> timer <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb13-731"><a href="#cb13-731" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> value<span class="op">;</span></span>
<span id="cb13-732"><a href="#cb13-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-733"><a href="#cb13-733" aria-hidden="true" tabindex="-1"></a>    <span class="co">// On input, check if we recently reported a value.</span></span>
<span id="cb13-734"><a href="#cb13-734" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If we did, do nothing and wait for a delay;</span></span>
<span id="cb13-735"><a href="#cb13-735" aria-hidden="true" tabindex="-1"></a>    <span class="co">// otherwise, report the current value and set a timeout.</span></span>
<span id="cb13-736"><a href="#cb13-736" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">inputted</span>() {</span>
<span id="cb13-737"><a href="#cb13-737" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (timer <span class="op">!==</span> <span class="kw">null</span>) {</span>
<span id="cb13-738"><a href="#cb13-738" aria-hidden="true" tabindex="-1"></a>          <span class="pp">clearTimeout</span>(timer)<span class="op">;</span></span>
<span id="cb13-739"><a href="#cb13-739" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb13-740"><a href="#cb13-740" aria-hidden="true" tabindex="-1"></a>      timer <span class="op">=</span> <span class="pp">setTimeout</span>(delayed<span class="op">,</span> delay)<span class="op">;</span></span>
<span id="cb13-741"><a href="#cb13-741" aria-hidden="true" tabindex="-1"></a>      <span class="co">/*</span></span>
<span id="cb13-742"><a href="#cb13-742" aria-hidden="true" tabindex="-1"></a><span class="co">      } else {</span></span>
<span id="cb13-743"><a href="#cb13-743" aria-hidden="true" tabindex="-1"></a><span class="co">          notify(value = input.value);</span></span>
<span id="cb13-744"><a href="#cb13-744" aria-hidden="true" tabindex="-1"></a><span class="co">          timer = setTimeout(delayed, delay);</span></span>
<span id="cb13-745"><a href="#cb13-745" aria-hidden="true" tabindex="-1"></a><span class="co">      }</span></span>
<span id="cb13-746"><a href="#cb13-746" aria-hidden="true" tabindex="-1"></a><span class="co">      */</span></span>
<span id="cb13-747"><a href="#cb13-747" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-748"><a href="#cb13-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-749"><a href="#cb13-749" aria-hidden="true" tabindex="-1"></a>    <span class="co">// After a delay, check if the last-reported value is the current value.</span></span>
<span id="cb13-750"><a href="#cb13-750" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If it’s not, report the new value.</span></span>
<span id="cb13-751"><a href="#cb13-751" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">delayed</span>() {</span>
<span id="cb13-752"><a href="#cb13-752" aria-hidden="true" tabindex="-1"></a>      timer <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb13-753"><a href="#cb13-753" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (value <span class="op">===</span> input<span class="op">.</span><span class="at">value</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb13-754"><a href="#cb13-754" aria-hidden="true" tabindex="-1"></a>      <span class="fu">notify</span>(value <span class="op">=</span> input<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb13-755"><a href="#cb13-755" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-756"><a href="#cb13-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-757"><a href="#cb13-757" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> inputted)<span class="op">,</span> <span class="fu">inputted</span>()<span class="op">;</span></span>
<span id="cb13-758"><a href="#cb13-758" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> input<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> inputted)<span class="op">;</span></span>
<span id="cb13-759"><a href="#cb13-759" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-760"><a href="#cb13-760" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-9-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->

<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"import { fmt_pct, rate, fmt_surname, AP, load_image } from \"./utils.js\"\nd3 = require(\"d3\")\n\nd_sum = FileAttachment(\"summary.json\").json()\ndistrs = FileAttachment(\"house_districts.csv\").csv({typed: true});\nstates = FileAttachment(\"senate_races.csv\").csv({typed: true});\ngeom_hex = FileAttachment(\"hex.json\").json()\ngeom_states = FileAttachment(\"states.json\").json()\n\ndraws = {\n    let names = await FileAttachment(\"draws_cols.json\").json()\n    let raw = await load_image(\"draws.png\");\n    let out = new Array(raw.h);\n    \n    const n_house = distrs.reduce((accuml, x) => accuml + !x.unopp, 0);\n    const n_sen = states.reduce((accuml, x) => accuml + !x.unopp, 0);\n    for (let i = 0; i < raw.h; i++) {\n        let obj = {}\n        obj.pred_natl = (raw[i*raw.w + 0] + 2.0) / 5.0;\n        obj.seats_house = Math.round((raw[i*raw.w + 1] + 0.5) * 200.0);\n        obj.seats_sen = Math.round((raw[i*raw.w + 2] + 1.5) * 25.0);\n        for (let j = 3; j < names.length; j++) {\n            obj[names[j]] = raw[i*raw.w + j];\n        }\n        out[i] = obj;\n    }\n    \n    return out;\n}\n\nd_distrs = d3.index(distrs.map(d => {\n        let at_large = [\"AK\", \"DE\", \"ND\", \"SD\", \"VT\", \"WY\"].includes(d.state);\n        d.name = AP[d.state] + \" \" + (at_large ? \"At-Large\" : d.district);\n        d.name_short = AP[d.state] +  (at_large ? \"\" : \" \" + d.district);\n        d.rcv = [\"AK\", \"ME\"].includes(d.state);\n        d.interval = [d.dem_mean, d.dem_q10, d.dem_q25, d.dem_q75, d.dem_q90, d.rcv];\n        d.rating = rate(d.pr_dem);\n        d.margin = Math.abs(d.dem_mean - 0.5);\n        d.dem_cand = fmt_surname(d.dem_cand);\n        d.rep_cand = fmt_surname(d.rep_cand);\n        if (d.state == \"AK\") {\n            d.dem_cand = null;\n            d.rep_cand = null;\n        }\n        d.cands = [d.dem_cand, d.rep_cand, d.inc_seat];\n        d.search = {dem: \"incumbent dem. \", open: \"open seat \", gop: \"incumbent rep. incumbent gop. \"}[d.inc_seat] \n                + [\"contested \", \"unopposed uncontested \"][d.unopp];\n        return d;\n    }), \n    d => d.state, d => d.district);\nd_states = d3.index(states.map(d => {\n        d.name = AP[d.state];\n        d.rcv = [\"AK\", \"ME\"].includes(d.state);\n        if (d.state == \"OK\" && d.rep_cand == \"M. MULLIN\") {\n            d.state = \"OK-S\";\n            d.name += \" Special\"\n        }\n        d.interval = [d.dem_mean, d.dem_q10, d.dem_q25, d.dem_q75, d.dem_q90, d.rcv];\n        d.rating = rate(d.pr_dem);\n        d.margin = Math.abs(d.dem_mean - 0.5);\n        d.dem_cand = fmt_surname(d.dem_cand);\n        d.rep_cand = fmt_surname(d.rep_cand);\n        if (d.state == \"AK\") {\n            d.dem_cand = null;\n            d.rep_cand = null;\n        }\n        d.cands = [d.dem_cand, d.rep_cand, d.inc_seat];\n        d.search = {dem: \"incumbent dem. \", open: \"open seat \", gop: \"incumbent rep. incumbent gop. \"}[d.inc_seat] \n                + [\"contested \", \"unopposed uncontested \"][d.unopp];\n        return d;\n    }), \n    d => d.state);\n\nDARK_BLUE = \"#0063B1\"\nDARK_RED = \"#A0442C\"\nBLUE = \"#3D77BB\"\nRED = \"#B25D4C\"\nw_BODY = 796;\nSMALL = width < 600;\nelec_date = new Date(\"2022-11-08\")\n\n\ncolor = {\n    let midpt = \"#fafffa\";\n    let color_dem = d3.scaleLinear()\n        .domain([0.5, 1.0])\n        .range([midpt, DARK_BLUE]);\n    let color_gop = d3.scaleLinear()\n        .domain([0.0, 0.5])\n        .range([DARK_RED, midpt]);\n    return x => x <= 0.5 ? color_gop(x) : color_dem(x);\n}\n\nwindow.d3 = d3;\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"viewof text = Inputs.textarea({\n    placeholder: `Enter filtering conditions here. For example:\n    WA-8 win D\n    DE-AL < 60%\n    OK-S GOP win\n    NC senate Dem loss\n    `,\n    spellcheck: false,\n    autocomplete: false,\n    autocapitalize: false,\n    rows: 5,\n    resize: true,\n    submit: false,\n    monospace: true,\n});\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"db_text = debounce(viewof text, 300);\nconstr = {\n    let lines = db_text.split(/\\r?\\n/)\n        .map(x => x.trim().replaceAll(/\\s+/g, \" \"))\n        .filter(x => x != \"\");\n        \n    const regex_race = /^([A-Z]{2})([- ](\\d{1,2}|AL|at[- ]large|S(?!\\w)|special|senate|S senate|senate special))?/i\n    let races = lines.map(x => {\n        let matches = x.match(regex_race);\n        if (matches === null) return \"\";\n        if (typeof matches[3] == \"undefined\") return matches[1];\n        if (matches[3].toLowerCase() == \"senate\") return matches[1];\n        if (/(AL|at[- ]large)/i.test(matches[3])) matches[3] = \"1\";\n        if (/(S(?!\\w)|special|S senate|senate special)/i.test(matches[3])) return matches[1] + \"-S\";\n        return matches[1] + \"-\" + (+matches[3]);\n    })\n    \n    let lower = lines.map(x => {\n        x = x.replace(\">=\", \">\")\n            .replace(/(win (D|dems?)|(D|dems?) win|(R|GOP|rep) lose|lose (R|GOP|rep))/i, \"> 50%\");\n        let matches = x.match(/> ?(\\d*(?:\\.\\d+)?%?)/);\n        if (matches === null) {\n            return 0.0;\n        } else {\n            let val = parseFloat(matches[1]);\n            if (matches[0].endsWith(\"%\")) val /= 100.0;\n            return val;\n        }\n    })\n    let upper = lines.map(x => {\n        x = x.replace(/<(?!=)/, \"<=\")\n            .replace(/(win (R|GOP|rep)|(R|GOP|rep) win|(D|dems?) los[es]|los[es] (D| dems?))/i, \"<= 49.999%\");\n        let matches = x.match(/<= ?(\\d*(?:\\.\\d+)?%?)/);\n        if (matches === null) {\n            return 1.0;\n        } else {\n            let val = parseFloat(matches[1]);\n            if (matches[0].endsWith(\"%\")) val /= 100.0;\n            return val;\n        }\n    })\n    \n    return d3.zip(races, lower, upper).map(x => { \n        if (x[1] >= x[2]) x[1] = 0;\n        return { key: x[0], lower: x[1], upper: x[2], };\n    });\n}\nwindow.constr = constr;\n\ndraws_f = draws.filter(x => {\n    for (let c of constr) {\n        if (c.key === null) continue;\n        if (x[c.key] <= c.lower || x[c.key] > c.upper) return false;\n    }\n    return true;\n});\nwindow.draws_f = draws_f;\n\nprob_distr = Object.fromEntries(Array.from(d_distrs).map(function([state, v0]) {\n    window.x = v0\n    return [state, Object.fromEntries(Array.from(v0).map(function([distr, v1]) {\n        let key = state + \"-\" + (+distr);\n        let prob = d3.mean(draws_f, x => x[key] >= 0.5)\n        return [+distr, prob];\n    }))]\n}));\nprob_state = Object.fromEntries(Array.from(d_states).map(\n    ([key, _]) => [key, d3.mean(draws_f, x => x[key] >= 0.5)]\n));\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"{\nlet exag_fac = 1 - Math.sqrt(width)/80;\nlet last_elec = 222;\nlet xmin = Math.max(Math.min(d_sum.house_q10*exag_fac, 218 - 10), 0)\nlet xmax = Math.min(Math.max(d_sum.house_q90/exag_fac, 218 + 10), 435)\nlet median = d3.median(draws_f, d => d.seats_house);\nlet s_gain = (median >= last_elec ? \"+\" : \"-\") + Math.abs(last_elec - Math.round(median));\nlet breaks = Array(~~((xmax - xmin)/4)).fill().map((e, i) => 4*i + 0.5 + ~~xmin);\nwindow.breaks=breaks;\n\nlet text_shadow = function(text, opt) {\n    let opt2 = {...opt}\n    opt2.dx = opt2.dx + 3\n    opt2.dy = opt2.dy + 3\n    opt2.fill = \"#0007\"\n    opt2.strokeWidth = 0\n    return [Plot.text([text], opt2), Plot.text([text], opt)]\n}\n\nlet plot = Plot.plot({\n    x: {\n        domain: [xmin, xmax],\n        round: true,\n        clamp: true,\n        inset: 10,\n        tickSize: 8,\n        reverse: true,\n        label: null,\n    },\n    y: {\n        legend: false,\n        axis: null,\n        insetTop: 4,\n    },\n    color: {\n        legend: false,\n    },\n    marks: [\n        Plot.rectY(draws_f, Plot.binX({y: \"count\"}, {\n                x: \"seats_house\",\n                fill: d => d.seats_house >= 218 ? BLUE : RED,\n                inset: 0,\n                thresholds: breaks, \n            })),\n        Plot.ruleY([0]),\n        Plot.ruleY([0], {\n            dy: 2,\n            strokeWidth: 5,\n            x1: d3.quantile(draws_f, 0.1, x => x.seats_house),\n            x2: d3.quantile(draws_f, 0.9, x => x.seats_house),\n            color: \"red\",\n            }),\n        Plot.ruleX([last_elec, median]),\n        text_shadow(s_gain, { \n            x: median, dy: -48, dx: 3,\n            frameAnchor: \"bottom\", textAnchor: \"start\", lineAnchor: \"bottom\",\n            fill: \"white\", strokeWidth: 4, stroke: \"black\", fontSize: 40, fontWeight: \"bold\",\n            }),\n        text_shadow(median >= last_elec ? \"GAIN\" : \"LOSS\", { \n            x: median, dy: -42, dx: 5,\n            frameAnchor: \"bottom\", textAnchor: \"start\", lineAnchor: \"top\",\n            fill: \"white\", strokeWidth: 2, stroke: \"black\", fontSize: 14, fontWeight: \"bold\",\n            }),\n        Plot.text([\"← DEM. MAJORITY\"], { \n            x: 217.5, dy: -4, dx: -3,\n            frameAnchor: \"bottom\", textAnchor: \"end\",\n            fontWeight: \"bold\", fill: \"#111\",\n            }),\n        Plot.text([\"REP. MAJORITY →\"], { \n            x: 217.5, dy: -4, dx: 3,\n            frameAnchor: \"bottom\", textAnchor: \"start\",\n            fontWeight: \"bold\", fill: \"#111\",\n            }),\n         Plot.text([last_elec + \" LAST ELECTION\"], { \n            x: last_elec, dy: -4,\n            frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n            fontWeight: \"bold\",\n            }),\n         Plot.text([\"← DEM. HOUSE SEATS\"], { \n            x: xmax, dy: -4 - (SMALL ? 10 : 0), dx: 4,\n            frameAnchor: \"bottom\", textAnchor: \"start\",\n            fontWeight: \"bold\",\n            }),\n    ],\n    \n    width: width,\n    height: 240,\n    marginTop: 24,\n    marginBottom: 0,\n    marginLeft: 0,\n    marginRight: 0,\n    \n    style: {\n        fontSize: 9,\n        color: \"#444\",\n        overflow: \"visible\",\n    }\n})\nreturn plot;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"dem_lead = true; // d_sum.house_prob > 0.5\n{\n    let q50 = d3.median(draws_f, x => x.pred_natl);\n    let dem_prob_house = d3.mean(draws_f, x => x.seats_house >= 218);\n    let dem_prob_sen = d3.mean(draws_f, x => x.seats_sen >= 50);\n    \n    let win_party = dem_lead ? \"Democrats\" : \"Republicans\"\n    let win_class = dem_lead ? \"dem\" : \"rep\"\n    let pct = fmt_pct(dem_lead ? q50 : 1 - q50, 1);\n    let phrase = dem_lead ? \"controlling\" : \"flipping\"\n    let prob_house = dem_lead ? dem_prob_house : 1 - dem_prob_house\n    let prob_sen = dem_lead ? dem_prob_sen : 1 - dem_prob_sen\n    \n    return md`\nUnder these conditions, the <b class=\"${win_class}\">${win_party}</b> would be expected to win\n**around ${pct} of the popular vote**.\n\nThey would have a **${fmt_pct(prob_house)} chance** of ${phrase} the House and \na **${fmt_pct(prob_sen)} chance** of ${phrase} the Senate.\n\n<p class=\"updated\">${draws_f.length} draws\n(${fmt_pct(draws_f.length/draws.length)}) in use.</p>`;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"{\nlet exag_fac = 1 - Math.sqrt(width)/160;\nlet last_elec = 50;\nlet xmin = Math.max(Math.min(d_sum.sen_q10*exag_fac, 50 - 10), 0)\nlet xmax = Math.min(Math.max(d_sum.sen_q90/exag_fac, 50 + 10), 100)\nlet median = d3.median(draws_f, d => d.seats_sen);\nlet s_gain = (median >= last_elec ? \"+\" : \"-\") + Math.abs(last_elec - Math.round(median));\nlet breaks = Array(~~(xmax - xmin)).fill().map((e, i) => i + 0.5 + ~~xmin);\n\nlet text_shadow = function(text, opt) {\n    let opt2 = {...opt}\n    opt2.dx = opt2.dx + 3\n    opt2.dy = opt2.dy + 3\n    opt2.fill = \"#0007\"\n    opt2.strokeWidth = 0\n    return [Plot.text([text], opt2), Plot.text([text], opt)]\n}\n\nlet plot = Plot.plot({\n    x: {\n        domain: [xmin, xmax],\n        clamp: true,\n        inset: 10,\n        tickSize: 8,\n        reverse: true,\n        axis: \"top\",\n        label: null,\n    },\n    y: {\n        legend: false,\n        axis: null,\n        insetBottom: 4,\n    },\n    color: {\n        legend: false,\n    },\n    marks: [\n        Plot.rectY(draws_f, Plot.binX({\n                y: x => -x.length,\n            }, {\n                x: \"seats_sen\",\n                fill: d => d.seats_sen >= 50 ? BLUE : RED,\n                thresholds: breaks, \n            })),\n        Plot.ruleY([0]),\n        Plot.ruleY([0], {\n            dy: 2,\n            strokeWidth: 5,\n            x1: d3.quantile(draws_f, 0.1, x => x.seats_sen),\n            x2: d3.quantile(draws_f, 0.9, x => x.seats_sen),\n            color: \"red\",\n            }),\n        Plot.ruleX([last_elec, median]),\n        text_shadow(s_gain, { \n            x: median, dy: 48, dx: 3,\n            frameAnchor: \"top\", textAnchor: \"start\", lineAnchor: \"top\",\n            fill: \"white\", strokeWidth: 4, stroke: \"black\", fontSize: 40, fontWeight: \"bold\",\n            }),\n        text_shadow(median >= last_elec ? \"GAIN\" : \"LOSS\", { \n            x: median, dy: 42, dx: 5,\n            frameAnchor: \"top\", textAnchor: \"start\", lineAnchor: \"bottom\",\n            fill: \"white\", strokeWidth: 2, stroke: \"black\", fontSize: 14, fontWeight: \"bold\",\n            }),\n        Plot.text([\"← DEM. MAJORITY\"], { \n            x: 49.5, dy: 8, dx: -3,\n            frameAnchor: \"top\", textAnchor: \"end\",\n            fontWeight: \"bold\", fill: \"#111\",\n            }),\n        Plot.text([\"REP. MAJORITY →\"], { \n            x: 49.5, dy: 8, dx: 3,\n            frameAnchor: \"top\", textAnchor: \"start\",\n            fontWeight: \"bold\", fill: \"#111\",\n            }),\n         Plot.text([last_elec + \" LAST ELECTION\"], { \n            x: last_elec, dy: 8,\n            frameAnchor: \"bottom\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n            fontWeight: \"bold\",\n            }),\n         Plot.text([\"← DEM. SENATE SEATS\"], { \n            x: xmax, dy: 4 + (SMALL ? 10 : 0), dx: 4,\n            frameAnchor: \"top\", textAnchor: \"start\",\n            fontWeight: \"bold\",\n            }),\n    ],\n    \n    width: width,\n    height: 240,\n    marginTop: 0,\n    marginLeft: 0,\n    marginRight: 0,\n    \n    style: {\n        fontSize: 9,\n        color: \"#444\",\n        overflow: \"visible\",\n    }\n})\nreturn plot;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"house_map = {\nlet distrs = topojson.feature(geom_hex, geom_hex.objects.foo).features.map(d => {\n    d.match = d_distrs.get(d.properties.state).get(d.properties.district);\n    d.flip = ((d.match.pr_dem > 0.5 && d.match.inc_seat == \"gop\") \n                || (d.match.pr_dem < 0.5 && d.match.inc_seat == \"dem\"))\n            && (Math.abs(d.match.pr_dem - 0.5) > 0.01);\n    return d;\n})\n    \nconst w = 960;\nconst h = w * 0.72;\nconst GOLD = \"#bc1\";\n\nconst svg = d3\n    .create(\"svg\")\n    .attr(\"viewBox\", [0, 0, w, h])\n    .style(\"width\", \"100%\")\n    .style(\"height\", \"auto\");\n\nlet proj = d3.geoAlbers()\n    .scale(0.92*w)\n    .translate([0.97*w/2, 0.94*h/2]);\nlet path = d3.geoPath(proj);\n\nlet geom_distrs = svg\n    .append(\"g\")\n    .attr(\"class\", \"distrs\")\n    .selectAll(\"path\")\n    .data(distrs)\n    .enter().append(\"path\")\n    .attr(\"fill\", \"#fff\")\n    .attr(\"stroke\", \"#111\")\n    .attr(\"stroke-width\", 0.5)\n    .attr(\"d\", path);\n\nlet geom_distrs_hover = svg\n    .append(\"g\")\n    .attr(\"class\", \"distrs\")\n    .selectAll(\"path\")\n    .data(distrs)\n    .enter().append(\"path\")\n    .attr(\"fill\", d => d.flip ? \"url(#diagonalHatch)\" : \"none\")\n    .attr(\"stroke\", \"#000\")\n    .attr(\"stroke-width\", 0.0)\n    .attr(\"d\", path);    \n\nlet tt = d3.select(\"#plot-house-map\").append(\"div\")\n        .attr(\"class\", \"map-tooltip\")\n        .style(\"visibility\", \"hidden\");\nlet prob_table;\n    \nlet mmv = function(e, d) {\n    let [mx, my] = d3.pointer(e);\n    let svg_dim = svg.node().getBoundingClientRect();\n    let w_fac = svg_dim.width/w;\n    if (mx < 50/w_fac) mx = 50/w_fac;\n    if (mx > w - 190/w_fac) mx = w - 190/w_fac;\n    \n    let prob = prob_table[d.match.state][d.match.district];\n    let cand;\n    let miss;\n    if (prob > 0.5) {\n        cand = !d.match.dem_cand ? \"Democrats\" : d.match.dem_cand;\n        miss = !d.match.dem_cand;\n    } else {\n        cand = !d.match.rep_cand ? \"Republicans\" : d.match.rep_cand;\n        miss = !d.match.rep_cand;\n    }\n    let inc = {\n        dem: `<b style='color: ${DARK_BLUE}'>Dem.</b> incumbent`,\n        gop: `<b style='color: ${DARK_RED}'>Rep.</b> incumbent`,\n        open: \"<b>Open</b> seat\",\n    }[d.match.inc_seat]\n    let prob_text;\n    let prob_color = prob > 0.5 ? DARK_BLUE : DARK_RED;\n    if (d.match.unopp == 1) {\n        prob_text = `<b style=\"color: ${prob_color}\">${cand}</b>\n            ${miss ? \"are\" : \"is\"} running unopposed and will win the seat.`\n    } else {\n        prob_text = `<b style=\"color: ${prob_color}\">${cand}</b> \n            would have a \n            <b>${fmt_pct(prob > 0.5 ? prob : 1 - prob)}</b> chance of winning.`\n    }\n    let disclaimer = d.match.rcv ? `<p style=\"color: #777; font-size: 0.75em; font-style: italic; margin-top: 0.5em;\">\n        Estimates do not account for rank-choice voting.\n    </p>` : \"\";\n    \n    d3.select(this).attr(\"stroke-width\", 2.4);\n    \n    let txt = `<h3>${d.match.name}</h3>\n        <p>${inc}</p>\n        <div style=\"width: 100%; height: 1rem; margin: 4px 0; display: flex;\">\n        <div style=\"background: ${BLUE}; flex-basis: ${100*prob}%\"></div>\n        <div style=\"background: ${RED}; flex-basis: ${100 - 100*prob}%\"></div>\n        </div>\n        <p>${prob_text}</p>\n        ${disclaimer}\n        `;\n\n    tt.style(\"visibility\", \"visible\")\n      .html(txt)\n      .style(\"left\", (mx - 50)*svg_dim.width/w + \"px\")\n      .style(\"bottom\", (h - my + 25)*svg_dim.height/h + \"px\");\n}\nlet mout = function(d) {\n    geom_distrs_hover.attr(\"stroke-width\", 0.0);\n    tt.style(\"visibility\", \"hidden\");\n}\n\ngeom_distrs_hover.on(\"mousemove\", mmv);\ngeom_distrs_hover.on(\"touchmove\", mmv);\nsvg.on(\"mouseout\", mout);\nsvg.on(\"touchend\", mout);\n\nlet node = svg.node();\nObject.defineProperty(node, \"value\", {\n    get() {\n        return draws;\n    },\n    set(v) {\n        prob_table = v;\n        geom_distrs.attr(\"fill\", d => {\n            return color(prob_table[d.match.state][d.match.district]);\n        })\n    }\n});\n\nreturn node;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"sen_map = {\nlet states = topojson.feature(geom_states, geom_states.objects.foo).features.map(d => {\n    d.match = d_states.get(d.properties.state);\n    if (typeof d.match == \"undefined\") {\n        d.flip = false;\n        d.match = null;\n    } else {\n        d.flip = ((d.match.pr_dem > 0.5 && d.match.inc_seat == \"gop\") \n                    || (d.match.pr_dem < 0.5 && d.match.inc_seat == \"dem\"))\n                && (Math.abs(d.match.pr_dem - 0.5) > 0.01);\n    }\n    return d;\n})\n    \nconst w = 960;\nconst h = w * 0.70;\nconst GOLD = \"#bc1\";\n\nconst svg = d3\n    .create(\"svg\")\n    .attr(\"viewBox\", [0, 0, w, h])\n    .style(\"width\", \"100%\")\n    .style(\"height\", \"auto\");\n\nlet proj = d3.geoAlbers()\n    .scale(1.40*w)\n    .translate([0.78*w/2, 0.14*h/2]);\nlet path = d3.geoPath(proj);\n\nlet geom_distrs = svg\n    .append(\"g\")\n    .attr(\"class\", \"distrs\")\n    .selectAll(\"path\")\n    .data(states)\n    .enter().append(\"path\")\n    .attr(\"fill\", \"#fff\")\n    .attr(\"stroke\", \"#111\")\n    .attr(\"stroke-width\", 0.5)\n    .attr(\"d\", path);\n\nlet geom_distrs_hover = svg\n    .append(\"g\")\n    .attr(\"class\", \"distrs\")\n    .selectAll(\"path\")\n    .data(states)\n    .enter().append(\"path\")\n    .attr(\"fill\", d => d.flip ? \"url(#diagonalHatch)\" : \"none\")\n    .attr(\"stroke\", \"#000\")\n    .attr(\"stroke-width\", 0.0)\n    .attr(\"d\", path);    \n\nlet tt = d3.select(\"#plot-sen-map\").append(\"div\")\n        .attr(\"class\", \"map-tooltip\")\n        .style(\"visibility\", \"hidden\");\nlet prob_table;\n    \nlet mmv = function(e, d) {\n    let [mx, my] = d3.pointer(e);\n    let svg_dim = svg.node().getBoundingClientRect();\n    let w_fac = svg_dim.width/w;\n    if (mx < 50/w_fac) mx = 50/w_fac;\n    if (mx > w - 190/w_fac) mx = w - 190/w_fac;\n    \n    d3.select(this).attr(\"stroke-width\", 2.4);\n    \n    let txt;\n    if (d.match === null) {\n        txt = `<h3>${AP[d.properties.state]}</h3><p></p>\n            <p>No election this year.</p>`;\n    } else {\n        let prob = prob_table[d.match.state];\n        let cand;\n        let miss;\n        if (prob > 0.5) {\n            cand = !d.match.dem_cand ? \"Democrats\" : d.match.dem_cand;\n            miss = !d.match.dem_cand;\n        } else {\n            cand = !d.match.rep_cand ? \"Republicans\" : d.match.rep_cand;\n            miss = !d.match.rep_cand;\n        }\n        let inc = {\n            dem: `<b style='color: ${DARK_BLUE}'>Dem.</b> incumbent`,\n            gop: `<b style='color: ${DARK_RED}'>Rep.</b> incumbent`,\n            open: \"<b>Open</b> seat\",\n        }[d.match.inc_seat]\n        let prob_text;\n        let prob_color = prob > 0.5 ? DARK_BLUE : DARK_RED;\n        if (d.match.unopp == 1) {\n            prob_text = `<b style=\"color: ${prob_color}\">${cand}</b>\n                ${miss ? \"are\" : \"is\"} running unopposed and will win the seat.`\n        } else {\n            prob_text = `<b style=\"color: ${prob_color}\">${cand}</b> \n                would have a \n                <b>${fmt_pct(prob > 0.5 ? prob : 1 - prob)}</b> chance of winning.`\n        }\n        let disclaimer = d.match.rcv ? `<p style=\"color: #777; font-size: 0.75em; font-style: italic; margin-top: 0.5em;\">\n            Estimates do not account for rank-choice voting.\n        </p>` : \"\";\n        \n        txt = `<h3>${d.match.name}</h3>\n            <p>${inc}</p>\n            <div style=\"width: 100%; height: 1rem; margin: 4px 0; display: flex;\">\n            <div style=\"background: ${BLUE}; flex-basis: ${100*prob}%\"></div>\n            <div style=\"background: ${RED}; flex-basis: ${100 - 100*prob}%\"></div>\n            </div>\n            <p>${prob_text}</p>\n            ${disclaimer}\n            `;\n    }\n\n    tt.style(\"visibility\", \"visible\")\n      .html(txt)\n      .style(\"left\", (mx - 50)*svg_dim.width/w + \"px\")\n      .style(\"bottom\", (h - my + 25)*svg_dim.height/h + \"px\");\n}\nlet mout = function(d) {\n    geom_distrs_hover.attr(\"stroke-width\", 0.0);\n    tt.style(\"visibility\", \"hidden\");\n}\n\ngeom_distrs_hover.on(\"mousemove\", mmv);\ngeom_distrs_hover.on(\"touchmove\", mmv);\nsvg.on(\"mouseout\", mout);\nsvg.on(\"touchend\", mout);\n\nlet node = svg.node();\n\nObject.defineProperty(node, \"value\", {\n    get() {\n        return draws;\n    },\n    set(v) {\n        prob_table = v;\n        geom_distrs.attr(\"fill\", d => {\n            if (d.match === null) {\n                return \"#c0c0c0\";\n            } else {\n                return color(prob_table[d.match.state]);\n            }\n        })\n    }\n})\n\nreturn node;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"house_map.value = prob_distr;\nsen_map.value = prob_state;\n\nfunction debounce(input, delay = 1000) {\n  return Generators.observe(notify => {\n    let timer = null;\n    let value;\n\n    // On input, check if we recently reported a value.\n    // If we did, do nothing and wait for a delay;\n    // otherwise, report the current value and set a timeout.\n    function inputted() {\n      if (timer !== null) {\n          clearTimeout(timer);\n      }\n      timer = setTimeout(delayed, delay);\n      /*\n      } else {\n          notify(value = input.value);\n          timer = setTimeout(delayed, delay);\n      }\n      */\n    }\n\n    // After a delay, check if the last-reported value is the current value.\n    // If it’s not, report the new value.\n    function delayed() {\n      timer = null;\n      if (value === input.value) return;\n      notify(value = input.value);\n    }\n\n    input.addEventListener(\"input\", inputted), inputted();\n    return () => input.removeEventListener(\"input\", inputted);\n  });\n}\n"},{"methodName":"interpretQuiet","source":"shinyInput('text')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
</div> <!-- /content -->



</body></html>