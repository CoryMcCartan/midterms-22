<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.18">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cory McCartan">

<title>2022 House Forecast</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="model_files/libs/quarto-html/quarto.js"></script>
<script src="model_files/libs/quarto-html/popper.min.js"></script>
<link href="model_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script type="module" src="model_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="model_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="icon" href="https://corymccartan.com/us-house-18/assets/flag.gif">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2022 House Forecast</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Cory McCartan </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell" data-include="false">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="21" data-source-offset="-0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 20;"><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { fmt_pct<span class="op">,</span> rate<span class="op">,</span> fmt_surname<span class="op">,</span> AP } <span class="im">from</span> <span class="st">"./utils.js"</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>d_sum <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"summary.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>geom_hex <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"hex.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>d_history <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"history.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>d_gcb <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"natl_intent.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>d_hist <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"seats_hist.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>d_distr_list <span class="op">=</span> {</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> raw <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"districts.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> raw<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">name</span> <span class="op">=</span> AP[d<span class="op">.</span><span class="at">state</span>] <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> d<span class="op">.</span><span class="at">district</span><span class="op">;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">interval</span> <span class="op">=</span> [d<span class="op">.</span><span class="at">dem_mean</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q10</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q25</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q75</span><span class="op">,</span> d<span class="op">.</span><span class="at">dem_q90</span>]<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rating</span> <span class="op">=</span> <span class="fu">rate</span>(d<span class="op">.</span><span class="at">pr_dem</span>)<span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">dem_cand</span> <span class="op">=</span> <span class="fu">fmt_surname</span>(d<span class="op">.</span><span class="at">dem_cand</span>)<span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">rep_cand</span> <span class="op">=</span> <span class="fu">fmt_surname</span>(d<span class="op">.</span><span class="at">rep_cand</span>)<span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">search</span> <span class="op">=</span> {<span class="dt">dem</span><span class="op">:</span> <span class="st">"incumbent dem. "</span><span class="op">,</span> <span class="dt">open</span><span class="op">:</span> <span class="st">"open seat "</span><span class="op">,</span> <span class="dt">gop</span><span class="op">:</span> <span class="st">"incumbent rep. incumbent gop. "</span>}[d<span class="op">.</span><span class="at">inc_seat</span>] </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> [<span class="st">"contested "</span><span class="op">,</span> <span class="st">"unopposed uncontested "</span>][d<span class="op">.</span><span class="at">unopp</span>]<span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>d_distr <span class="op">=</span> d3<span class="op">.</span><span class="fu">index</span>(d_distr_list<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">state</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">district</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>DARK_BLUE <span class="op">=</span> <span class="st">"#0063B1"</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>DARK_RED <span class="op">=</span> <span class="st">"#A0442C"</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>BLUE <span class="op">=</span> <span class="st">"#3D77BB"</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>RED <span class="op">=</span> <span class="st">"#B25D4C"</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>w_BODY <span class="op">=</span> <span class="dv">796</span><span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>SMALL <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>elec_date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">"2022-11-08"</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> {</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> midpt <span class="op">=</span> <span class="st">"#fafffa"</span><span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> color_dem <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="fl">1.0</span>])</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([midpt<span class="op">,</span> DARK_BLUE])<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> color_gop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.5</span>])</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([DARK_RED<span class="op">,</span> midpt])<span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="kw">=&gt;</span> x <span class="op">&lt;=</span> <span class="fl">0.5</span> <span class="op">?</span> <span class="fu">color_gop</span>(x) <span class="op">:</span> <span class="fu">color_dem</span>(x)<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">Plot</span> <span class="op">=</span> Plot<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-18" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="64" data-source-offset="-1465"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 63;"><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">d3</span> <span class="op">=</span> d3<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-19" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="65" data-source-offset="-1481"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 64;"><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">d_distr_list</span> <span class="op">=</span> d_distr_list<span class="op">;</span></span></code></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-20" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="70" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 69;"><span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> exag_fac <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(width)<span class="op">/</span><span class="dv">80</span><span class="op">;</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> last_elec <span class="op">=</span> <span class="dv">222</span><span class="op">;</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> xmin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d_sum<span class="op">.</span><span class="at">s_q10</span><span class="op">*</span>exag_fac<span class="op">,</span> <span class="dv">218</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> xmax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d_sum<span class="op">.</span><span class="at">s_q90</span><span class="op">/</span>exag_fac<span class="op">,</span> <span class="dv">218</span> <span class="op">+</span> <span class="dv">10</span>)<span class="op">,</span> <span class="dv">435</span>)</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> s_gain <span class="op">=</span> <span class="st">"+"</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="dv">222</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(d_sum<span class="op">.</span><span class="at">s_med</span>))<span class="op">;</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> overl <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.58</span><span class="op">,</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(width) <span class="op">/</span> <span class="dv">80</span>)<span class="op">;</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> text_shadow <span class="op">=</span> <span class="kw">function</span>(text<span class="op">,</span> opt) {</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> opt2 <span class="op">=</span> {<span class="op">...</span>opt}</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">dx</span> <span class="op">=</span> opt2<span class="op">.</span><span class="at">dx</span> <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">dy</span> <span class="op">=</span> opt2<span class="op">.</span><span class="at">dy</span> <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    opt2<span class="op">.</span><span class="at">fill</span> <span class="op">=</span> <span class="st">"#0007"</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [Plot<span class="op">.</span><span class="fu">text</span>([text]<span class="op">,</span> opt2)<span class="op">,</span> Plot<span class="op">.</span><span class="fu">text</span>([text]<span class="op">,</span> opt)]</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">plot</span> <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        <span class="dt">domain</span><span class="op">:</span> [xmin<span class="op">,</span> xmax]<span class="op">,</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clamp</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inset</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>        <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        <span class="dt">axis</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">rectY</span>(d_hist<span class="op">,</span> {</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">dem_seats</span> <span class="op">-</span> overl<span class="op">,</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">dem_seats</span> <span class="op">+</span> overl<span class="op">,</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>                <span class="dt">y</span><span class="op">:</span> <span class="st">"pr"</span><span class="op">,</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">dem_seats</span> <span class="op">&gt;=</span> <span class="dv">218</span> <span class="op">?</span> BLUE <span class="op">:</span> RED<span class="op">,</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>            <span class="dt">dy</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x1</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">s_q10</span><span class="op">,</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x2</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">s_q90</span><span class="op">,</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>            <span class="dt">color</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="dv">222</span><span class="op">,</span> d_sum<span class="op">.</span><span class="at">s_med</span>])<span class="op">,</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text_shadow</span>(s_gain<span class="op">,</span> { </span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">s_med</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">48</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text_shadow</span>(<span class="st">"GAIN"</span><span class="op">,</span> { </span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">s_med</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">42</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">14</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"← DEM. MAJORITY"</span>]<span class="op">,</span> { </span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="fl">217.5</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="op">-</span><span class="dv">3</span><span class="op">,</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"end"</span><span class="op">,</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#111"</span><span class="op">,</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"REP. MAJORITY →"</span>]<span class="op">,</span> { </span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="fl">217.5</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#111"</span><span class="op">,</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>         Plot<span class="op">.</span><span class="fu">text</span>([last_elec <span class="op">+</span> <span class="st">" LAST ELECTION"</span>]<span class="op">,</span> { </span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> last_elec<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>         Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"← DEM. SEATS"</span>]<span class="op">,</span> { </span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> xmax<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span> <span class="op">-</span> (SMALL <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">0</span>)<span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>            <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> width<span class="op">,</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">240</span><span class="op">,</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">"#444"</span><span class="op">,</span></span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>        <span class="dt">overflow</span><span class="op">:</span> <span class="st">"visible"</span><span class="op">,</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="bu">window</span><span class="op">.</span><span class="at">plot</span><span class="op">;</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-hist" class="cell-output cell-output-display column-screen">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="banner page-columns page-full">
<div id="summary" class="cell page-columns page-full">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="172" data-source-offset="-1"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 171;"><span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>dem_lead <span class="op">=</span> d_sum<span class="op">.</span><span class="at">s_prob</span> <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> win_party <span class="op">=</span> dem_lead <span class="op">?</span> <span class="st">"Democrats"</span> <span class="op">:</span> <span class="st">"Republicans"</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> win_class <span class="op">=</span> dem_lead <span class="op">?</span> <span class="st">"dem"</span> <span class="op">:</span> <span class="st">"rep"</span></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> min_seats <span class="op">=</span> dem_lead <span class="op">?</span> d_sum<span class="op">.</span><span class="at">s_q10</span> <span class="op">:</span> <span class="dv">435</span> <span class="op">-</span> d_sum<span class="op">.</span><span class="at">s_q90</span></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> max_seats <span class="op">=</span> dem_lead <span class="op">?</span> d_sum<span class="op">.</span><span class="at">s_q90</span> <span class="op">:</span> <span class="dv">435</span> <span class="op">-</span> d_sum<span class="op">.</span><span class="at">s_q10</span></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> phrase <span class="op">=</span> dem_lead <span class="op">?</span> <span class="st">"maintaining"</span> <span class="op">:</span> <span class="st">"flipping"</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob <span class="op">=</span> dem_lead <span class="op">?</span> d_sum<span class="op">.</span><span class="at">s_prob</span> <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> d_sum<span class="op">.</span><span class="at">s_prob</span></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> timestamp <span class="op">=</span> d_history[d_history<span class="op">.</span><span class="at">length</span><span class="op">-</span><span class="dv">1</span>]<span class="op">.</span><span class="at">timestamp</span><span class="op">;</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> date_fmt <span class="op">=</span> timestamp<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-US"</span><span class="op">,</span> { </span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weekday</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span> </span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>            <span class="dt">month</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span> </span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>            <span class="dt">day</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span> </span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>            <span class="dt">hour</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span> </span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>            <span class="dt">minute</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>            <span class="dt">timeZoneName</span><span class="op">:</span> <span class="st">"short"</span><span class="op">,</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>            })       </span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a><span class="vs">The &lt;b class="</span><span class="sc">${</span>win_class<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>win_party<span class="sc">}</span><span class="vs">&lt;/b&gt; are expected to win</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a><span class="vs">**between </span><span class="sc">${</span>min_seats<span class="sc">}</span><span class="vs"> and </span><span class="sc">${</span>max_seats<span class="sc">}</span><span class="vs"> seats**.</span></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a><span class="vs">They have a **</span><span class="sc">${</span><span class="fu">fmt_pct</span>(prob)<span class="sc">}</span><span class="vs"> chance** of </span><span class="sc">${</span>phrase<span class="sc">}</span><span class="vs"> the House.</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;p class="updated"&gt;Last updated </span><span class="sc">${</span>date_fmt<span class="sc">}</span><span class="vs">.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="cell-output cell-output-display column-screen">
<div id="summary-1">
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="summary-2">
<div id="ojs-cell-3-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<!--
<div class="alert alert-dismissible alert-danger" style="margin-top: 1rem;">
<strong>NEW</strong><br /><hr />
<span style="color: black;">Look at this.</span>
</div>
-->
<section id="map" class="level2 page-columns page-full">
<h2 data-anchor-id="map">The House map</h2>
<div class="column-screen">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="212" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 211;"><span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> distrs <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(geom_hex<span class="op">,</span> geom_hex<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">foo</span>)<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">match</span> <span class="op">=</span> d_distr<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">state</span>)<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">district</span>)<span class="op">;</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">flip</span> <span class="op">=</span> ((d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span> <span class="op">==</span> <span class="st">"gop"</span>) </span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>                <span class="op">||</span> (d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span> <span class="op">==</span> <span class="st">"dem"</span>))</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;&amp;</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span> <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">&gt;</span> <span class="fl">0.1</span>)<span class="op">;</span></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> w <span class="op">=</span> <span class="dv">960</span><span class="op">;</span></span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> h <span class="op">=</span> w <span class="op">*</span> <span class="fl">0.72</span><span class="op">;</span></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> GOLD <span class="op">=</span> <span class="st">"#bc1"</span><span class="op">;</span></span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"auto"</span>)<span class="op">;</span></span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> proj <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoAlbers</span>()</span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scale</span>(<span class="fl">0.9</span><span class="op">*</span>w)</span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="fl">0.98</span><span class="op">*</span>w<span class="op">/</span><span class="dv">2</span><span class="op">,</span> <span class="fl">0.91</span><span class="op">*</span>h<span class="op">/</span><span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(proj)<span class="op">;</span></span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geom_distrs <span class="op">=</span> svg</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"distrs"</span>)</span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(distrs)</span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span>))</span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#111"</span>)</span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span>)</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geom_distrs_hover <span class="op">=</span> svg</span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"distrs"</span>)</span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(distrs)</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">flip</span> <span class="op">?</span> <span class="st">"url(#diagonalHatch)"</span> <span class="op">:</span> <span class="st">"none"</span>)</span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.0</span>)</span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span>    </span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> tt <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#plot-map"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"map-tooltip"</span>)</span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> mmv <span class="op">=</span> <span class="kw">function</span>(e<span class="op">,</span> d) {</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> [mx<span class="op">,</span> my] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(e)<span class="op">;</span></span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mx <span class="op">&lt;</span> <span class="dv">60</span>) mx <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mx <span class="op">&gt;</span> w <span class="op">-</span> <span class="dv">160</span>) mx <span class="op">=</span> w <span class="op">-</span> <span class="dv">160</span><span class="op">;</span></span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob <span class="op">=</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">pr_dem</span><span class="op">;</span></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cand<span class="op">;</span></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prob <span class="op">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>        cand <span class="op">=</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span> <span class="op">==</span> <span class="st">"NA"</span> <span class="op">?</span> <span class="st">"The Democrat"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">dem_cand</span><span class="op">;</span></span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>        cand <span class="op">=</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span> <span class="op">==</span> <span class="st">"NA"</span> <span class="op">?</span> <span class="st">"The Republican"</span> <span class="op">:</span> d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">rep_cand</span><span class="op">;</span></span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> inc <span class="op">=</span> {</span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dem</span><span class="op">:</span> <span class="vs">`&lt;b style='color: </span><span class="sc">${</span>DARK_BLUE<span class="sc">}</span><span class="vs">'&gt;Dem.&lt;/b&gt; incumbent`</span><span class="op">,</span></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>        <span class="dt">gop</span><span class="op">:</span> <span class="vs">`&lt;b style='color: </span><span class="sc">${</span>DARK_RED<span class="sc">}</span><span class="vs">'&gt;Rep.&lt;/b&gt; incumbent`</span><span class="op">,</span></span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a>        <span class="dt">open</span><span class="op">:</span> <span class="st">"&lt;b&gt;Open&lt;/b&gt; seat"</span><span class="op">,</span></span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a>    }[d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">inc_seat</span>]</span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob_text<span class="op">;</span></span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prob_color <span class="op">=</span> prob <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> DARK_BLUE <span class="op">:</span> DARK_RED<span class="op">;</span></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">unopp</span> <span class="op">==</span> <span class="dv">1</span>) {</span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>        prob_text <span class="op">=</span> <span class="vs">`&lt;b style="color: </span><span class="sc">${</span>prob_color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>cand<span class="sc">}</span><span class="vs">&lt;/b&gt;</span></span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a><span class="vs">            is running unopposed and will win the seat.`</span></span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a>        prob_text <span class="op">=</span> <span class="vs">`&lt;b style="color: </span><span class="sc">${</span>prob_color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span>cand<span class="sc">}</span><span class="vs">&lt;/b&gt; </span></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a><span class="vs">            has a &lt;b&gt;</span><span class="sc">${</span><span class="fu">fmt_pct</span>(prob <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> prob <span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> prob)<span class="sc">}</span><span class="vs">&lt;/b&gt; chance of winning.`</span></span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.4</span>)<span class="op">;</span></span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> txt <span class="op">=</span> <span class="vs">`&lt;h3&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">match</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;</span></span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span>inc<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="width: 100%; height: 1rem; margin: 4px 0; display: flex;"&gt;</span></span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="background: </span><span class="sc">${</span>BLUE<span class="sc">}</span><span class="vs">; flex-basis: </span><span class="sc">${</span><span class="dv">100</span><span class="op">*</span>prob<span class="sc">}</span><span class="vs">%"&gt;&lt;/div&gt;</span></span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div style="background: </span><span class="sc">${</span>RED<span class="sc">}</span><span class="vs">; flex-basis: </span><span class="sc">${</span><span class="dv">100</span> <span class="op">-</span> <span class="dv">100</span><span class="op">*</span>prob<span class="sc">}</span><span class="vs">%"&gt;&lt;/div&gt;</span></span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span>prob_text<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span><span class="op">;</span></span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> svg_dim <span class="op">=</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">;</span></span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>    tt<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>)</span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(txt)</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (mx <span class="op">-</span> <span class="dv">50</span>)<span class="op">*</span>svg_dim<span class="op">.</span><span class="at">width</span><span class="op">/</span>w <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"bottom"</span><span class="op">,</span> (h <span class="op">-</span> my <span class="op">+</span> <span class="dv">25</span>)<span class="op">*</span>svg_dim<span class="op">.</span><span class="at">height</span><span class="op">/</span>h <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> mout <span class="op">=</span> <span class="kw">function</span>(d) {</span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>    geom_distrs_hover<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.0</span>)<span class="op">;</span></span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a>    tt<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>geom_distrs_hover<span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> mmv)<span class="op">;</span></span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>geom_distrs_hover<span class="op">.</span><span class="fu">on</span>(<span class="st">"touchmove"</span><span class="op">,</span> mmv)<span class="op">;</span></span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> mout)<span class="op">;</span></span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"touchend"</span><span class="op">,</span> mout)<span class="op">;</span></span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-map" class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="gcb" class="level2">
<h2 data-anchor-id="gcb">Public opinion over time</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="326" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 325;"><span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>plot_gcb <span class="op">=</span> {</span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ci_w <span class="op">=</span> d_sum<span class="op">.</span><span class="at">i_q90</span> <span class="op">-</span> d_sum<span class="op">.</span><span class="at">i_q10</span></span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ymin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d_sum<span class="op">.</span><span class="at">i_med</span> <span class="op">-</span> <span class="dv">1</span><span class="op">*</span>ci_w<span class="op">,</span> <span class="fl">0.45</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ymax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d_sum<span class="op">.</span><span class="at">i_med</span> <span class="op">+</span> <span class="dv">1</span><span class="op">*</span>ci_w<span class="op">,</span> <span class="fl">0.52</span>)<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> today <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(elec_date<span class="op">,</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>())<span class="op">;</span></span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> days_til <span class="op">=</span> (elec_date <span class="op">-</span> today) <span class="op">/</span> (<span class="dv">24</span> <span class="op">*</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a>            <span class="dt">domain</span><span class="op">:</span> [ymin<span class="op">,</span> ymax]<span class="op">,</span></span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>            <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a>            <span class="dt">tickFormat</span><span class="op">:</span> <span class="st">"%"</span><span class="op">,</span></span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a>            <span class="dt">axis</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a>            <span class="dt">ticks</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="kw">null</span>}<span class="op">,</span></span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_gcb<span class="op">,</span> {</span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span></span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">q10</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">q90</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> BLUE<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_gcb<span class="op">,</span> {</span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span></span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">q25</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">q75</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> BLUE<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_gcb<span class="op">,</span> {</span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span></span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">q10</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">q90</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> RED<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_gcb<span class="op">,</span> {</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span></span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">q25</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">q75</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">,</span></span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> RED<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">line</span>(d_gcb<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">date</span> <span class="op">&lt;=</span> today)<span class="op">,</span> </span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a>                    {<span class="dt">x</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"natl_dem"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">line</span>(d_gcb<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">date</span> <span class="op">&gt;=</span> today)<span class="op">,</span> </span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a>                    {<span class="dt">x</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"natl_dem"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> </span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,3"</span><span class="op">,</span> <span class="dt">strokeLinecap</span><span class="op">:</span> <span class="st">"butt"</span> })<span class="op">,</span></span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="fl">0.5</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#0007"</span>})<span class="op">,</span></span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">rect</span>([<span class="dv">0</span>]<span class="op">,</span> {</span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x1</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> elec_date<span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> ymin<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> ymax<span class="op">,</span></span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> <span class="st">"#fff7"</span><span class="op">,</span></span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">ruleX</span>([elec_date<span class="op">,</span> today])<span class="op">,</span></span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([SMALL <span class="op">?</span> <span class="st">"Estimated Dem. vote"</span> <span class="op">:</span> <span class="st">"Estimated Democratic two-party vote"</span>]<span class="op">,</span> { </span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">min</span>(d_gcb<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">date</span>)<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"TODAY"</span>]<span class="op">,</span> { </span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([days_til <span class="op">&gt;</span> <span class="dv">20</span> <span class="op">+</span> SMALL<span class="op">*</span><span class="dv">30</span> <span class="op">?</span> <span class="st">"ELECTION DAY"</span> <span class="op">:</span> <span class="st">""</span>]<span class="op">,</span> { </span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> elec_date<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([<span class="fu">fmt_pct</span>(d_sum<span class="op">.</span><span class="at">i_med</span><span class="op">,</span> <span class="dv">1</span>)]<span class="op">,</span> { </span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> elec_date<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">i_med</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">6</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"end"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#223"</span><span class="op">,</span></span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true" tabindex="-1"></a>        <span class="dt">width</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(w_BODY<span class="op">,</span> width)<span class="op">,</span></span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true" tabindex="-1"></a>        <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-gcb" class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="table" class="level2">
<h2 data-anchor-id="table">The 435 House races</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="418" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 417;"><span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a>viewof search <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">search</span>(d_distr_list<span class="op">,</span> {</span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Districts:"</span><span class="op">,</span></span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [<span class="st">"name"</span><span class="op">,</span> <span class="st">"state"</span><span class="op">,</span> <span class="st">"inc_seat"</span><span class="op">,</span> <span class="st">"search"</span><span class="op">,</span> <span class="st">"rating"</span><span class="op">,</span> <span class="st">"dem_cand"</span><span class="op">,</span> <span class="st">"rep_cand"</span>]<span class="op">,</span></span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a>    <span class="dt">autocomplete</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(width <span class="op">-</span> <span class="dv">8</span><span class="op">,</span> w_BODY)<span class="op">,</span></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<p class="text-muted">
You can search by district state, number, candidate, incumbency, rating, or contestedness. Try searching for “Pelosi”, “WA 7,” “open,” “safe,” “contested,” “lean rep.,” or “tossup” seats.
</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="433" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 432;"><span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a>tab_distr <span class="op">=</span> {</span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="at">search</span> <span class="op">=</span> search<span class="op">;</span></span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> fmt_inc <span class="op">=</span> <span class="kw">function</span>(x) {</span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;span style="color: </span><span class="sc">${</span>{<span class="dt">dem</span><span class="op">:</span> DARK_BLUE<span class="op">,</span> <span class="dt">gop</span><span class="op">:</span> DARK_RED<span class="op">,</span> <span class="dt">open</span><span class="op">:</span> <span class="st">"black"</span>}[x]<span class="sc">}</span><span class="vs">"&gt;</span></span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span>{<span class="dt">dem</span><span class="op">:</span> <span class="st">"Dem."</span><span class="op">,</span> <span class="dt">gop</span><span class="op">:</span> <span class="st">"Rep."</span><span class="op">,</span> <span class="dt">open</span><span class="op">:</span> <span class="st">"Open"</span>}[x]<span class="sc">}</span></span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/span&gt;`</span></span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> fmt_part <span class="op">=</span> <span class="kw">function</span>(x) {</span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (x <span class="op">==</span> <span class="st">"NA"</span>) {</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;span style="color: #777"&gt;&amp;ndash;&lt;/span&gt;`</span></span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> color <span class="op">=</span> x <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> DARK_BLUE <span class="op">:</span> DARK_RED<span class="op">;</span></span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;span style="color: </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span><span class="fu">fmt_pct</span>(x<span class="op">,</span> <span class="dv">1</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span></span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> fmt_prob <span class="op">=</span> <span class="kw">function</span>(x) {</span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> tcolor <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(x <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">&gt;</span> <span class="fl">0.3</span> <span class="op">?</span> <span class="st">"#fffc"</span> <span class="op">:</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div class="chip" style="background: </span><span class="sc">${</span><span class="fu">color</span>(x)<span class="sc">}</span><span class="vs">; color: </span><span class="sc">${</span>tcolor<span class="sc">}</span><span class="vs">"&gt;</span></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span><span class="sc">${</span><span class="fu">fmt_pct</span>(x)<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xmin <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(d_distr_list<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">dem_q10</span>)</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> xmax <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(d_distr_list<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">dem_q90</span>)</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> avg <span class="op">=</span> <span class="dv">50</span><span class="op">*</span>(xmin <span class="op">+</span> xmax)<span class="op">;</span></span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([xmax<span class="op">,</span> xmin])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> x_dem <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([xmax<span class="op">,</span> <span class="fl">0.5</span>])<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> avg])<span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> x_rep <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="fl">0.5</span><span class="op">,</span> xmin])<span class="op">.</span><span class="fu">range</span>([avg<span class="op">,</span> <span class="dv">100</span>])<span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ici_d <span class="op">=</span> BLUE <span class="op">+</span> <span class="st">"bb"</span><span class="op">;</span></span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> oci_d <span class="op">=</span> BLUE <span class="op">+</span> <span class="st">"77"</span><span class="op">;</span></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ici_r <span class="op">=</span> RED <span class="op">+</span> <span class="st">"cc"</span><span class="op">;</span></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> oci_r <span class="op">=</span> RED <span class="op">+</span> <span class="st">"88"</span><span class="op">;</span></span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> fmt_vs <span class="op">=</span> <span class="kw">function</span>(int) {</span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (int[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"NA"</span>) {</span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div style="text-align: center; color: #777"&gt;(Unopposed)&lt;/div&gt;`</span></span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> gr <span class="op">=</span> <span class="vs">`linear-gradient(90deg, transparent 0%,</span></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a><span class="vs">               transparent </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">4</span>])<span class="sc">}</span><span class="vs">%, </span><span class="sc">${</span>oci_d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">4</span>])<span class="sc">}</span><span class="vs">%, </span></span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a><span class="vs">               </span><span class="sc">${</span>oci_d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">3</span>])<span class="sc">}</span><span class="vs">%, </span><span class="sc">${</span>ici_d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">3</span>])<span class="sc">}</span><span class="vs">%,</span></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a><span class="vs">               </span><span class="sc">${</span>ici_d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">2</span>])<span class="sc">}</span><span class="vs">%, </span><span class="sc">${</span>oci_d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">2</span>])<span class="sc">}</span><span class="vs">%,</span></span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a><span class="vs">               </span><span class="sc">${</span>oci_d<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">1</span>])<span class="sc">}</span><span class="vs">%, transparent </span><span class="sc">${</span><span class="fu">x_dem</span>(int[<span class="dv">1</span>])<span class="sc">}</span><span class="vs">%,</span></span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a><span class="vs">               transparent </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">4</span>])<span class="sc">}</span><span class="vs">%,  </span><span class="sc">${</span>oci_r<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">4</span>])<span class="sc">}</span><span class="vs">%, </span></span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a><span class="vs">               </span><span class="sc">${</span>oci_r<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">3</span>])<span class="sc">}</span><span class="vs">%, </span><span class="sc">${</span>ici_r<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">3</span>])<span class="sc">}</span><span class="vs">%,</span></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a><span class="vs">               </span><span class="sc">${</span>ici_r<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">2</span>])<span class="sc">}</span><span class="vs">%, </span><span class="sc">${</span>oci_r<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">2</span>])<span class="sc">}</span><span class="vs">%,</span></span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a><span class="vs">               </span><span class="sc">${</span>oci_r<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">1</span>])<span class="sc">}</span><span class="vs">%, transparent </span><span class="sc">${</span><span class="fu">x_rep</span>(int[<span class="dv">1</span>])<span class="sc">}</span><span class="vs">%,</span></span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a><span class="vs">               transparent 100%)`</span><span class="op">;</span></span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`</span></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a><span class="vs">                &lt;div class="est" style="background: </span><span class="sc">${</span>gr<span class="sc">}</span><span class="vs">; </span></span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a><span class="vs">                    padding-left: calc(</span><span class="sc">${</span><span class="fu">x</span>(int[<span class="dv">0</span>])<span class="sc">}</span><span class="vs">% - 6px);"&gt;</span></span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a><span class="vs">                &amp;#x25cf;&amp;nbsp;</span><span class="sc">${</span><span class="fu">fmt_pct</span>(int[<span class="dv">0</span>])<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a><span class="vs">                `</span><span class="op">;</span></span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> fmt_vs_tiny <span class="op">=</span> <span class="kw">function</span>(int) {</span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (int[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"NA"</span>) {</span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;span style="color: #777"&gt;(Unopp.)&lt;/span&gt;`</span></span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> color <span class="op">=</span> int[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">?</span> DARK_BLUE <span class="op">:</span> DARK_RED<span class="op">;</span></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;span style="color: </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">;"&gt;</span><span class="sc">${</span><span class="fu">fmt_pct</span>(int[<span class="dv">0</span>]<span class="op">,</span> <span class="dv">1</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cols <span class="op">=</span> [<span class="st">"name"</span><span class="op">,</span> <span class="st">"inc_seat"</span><span class="op">,</span> <span class="st">"pr_dem"</span><span class="op">,</span> <span class="st">"interval"</span><span class="op">,</span> <span class="st">"part_base"</span><span class="op">,</span> ]<span class="op">;</span></span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cols_small <span class="op">=</span> [<span class="st">"name"</span><span class="op">,</span> <span class="st">"inc_seat"</span><span class="op">,</span> <span class="st">"pr_dem"</span><span class="op">,</span> <span class="st">"interval"</span><span class="op">,</span> ]<span class="op">;</span></span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tiny <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">460</span><span class="op">;</span></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">table</span>(search<span class="op">,</span> {</span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>        <span class="dt">columns</span><span class="op">:</span> SMALL <span class="op">?</span> cols_small <span class="op">:</span> cols<span class="op">,</span></span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a>        <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">"District"</span><span class="op">,</span></span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a>            <span class="dt">inc_seat</span><span class="op">:</span> tiny <span class="op">?</span> <span class="st">"Inc."</span> <span class="op">:</span> <span class="st">"Incumbent"</span><span class="op">,</span></span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>            <span class="dt">pr_dem</span><span class="op">:</span> <span class="st">"Win prob."</span><span class="op">,</span></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a>            <span class="dt">interval</span><span class="op">:</span> tiny <span class="op">?</span> <span class="st">"Est. vote"</span> <span class="op">:</span> <span class="st">"Vote forecast"</span><span class="op">,</span></span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>            <span class="dt">part_base</span><span class="op">:</span> <span class="st">"2020 pres."</span><span class="op">,</span></span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a>            <span class="dt">inc_seat</span><span class="op">:</span> fmt_inc<span class="op">,</span></span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>            <span class="dt">pr_dem</span><span class="op">:</span> fmt_prob<span class="op">,</span></span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a>            <span class="dt">interval</span><span class="op">:</span> tiny <span class="op">?</span> fmt_vs_tiny <span class="op">:</span> fmt_vs<span class="op">,</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a>            <span class="dt">part_base</span><span class="op">:</span> fmt_part<span class="op">,</span></span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>        <span class="dt">width</span><span class="op">:</span> {</span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>            <span class="dt">interval</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>        <span class="dt">maxWidth</span><span class="op">:</span> w_BODY<span class="op">,</span></span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rows</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a>        <span class="dt">layout</span><span class="op">:</span> <span class="st">"fixed"</span><span class="op">,</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="distr-tab" class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="history" class="level2">
<h2 data-anchor-id="history">How the odds have changed</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="531" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 530;"><span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a>plot_prob <span class="op">=</span> {</span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> today <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(d_history<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">from_date</span>)<span class="op">;</span></span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> days_til <span class="op">=</span> (elec_date <span class="op">-</span> today) <span class="op">/</span> (<span class="dv">24</span> <span class="op">*</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a>            <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb10-539"><a href="#cb10-539" aria-hidden="true" tabindex="-1"></a>            <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb10-540"><a href="#cb10-540" aria-hidden="true" tabindex="-1"></a>            <span class="dt">tickFormat</span><span class="op">:</span> <span class="st">"%"</span><span class="op">,</span></span>
<span id="cb10-541"><a href="#cb10-541" aria-hidden="true" tabindex="-1"></a>            <span class="dt">axis</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb10-542"><a href="#cb10-542" aria-hidden="true" tabindex="-1"></a>            <span class="dt">ticks</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="fl">0.25</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.75</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb10-543"><a href="#cb10-543" aria-hidden="true" tabindex="-1"></a>            <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-544"><a href="#cb10-544" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb10-545"><a href="#cb10-545" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="kw">null</span>}<span class="op">,</span></span>
<span id="cb10-546"><a href="#cb10-546" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-547"><a href="#cb10-547" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb10-548"><a href="#cb10-548" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">line</span>(d_history<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"s_prob"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> BLUE})<span class="op">,</span></span>
<span id="cb10-549"><a href="#cb10-549" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">line</span>(d_history<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="dv">1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">s_prob</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> RED})<span class="op">,</span></span>
<span id="cb10-550"><a href="#cb10-550" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-551"><a href="#cb10-551" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="fl">0.5</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#0007"</span>})<span class="op">,</span></span>
<span id="cb10-552"><a href="#cb10-552" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">ruleX</span>([elec_date<span class="op">,</span> today])<span class="op">,</span></span>
<span id="cb10-553"><a href="#cb10-553" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-554"><a href="#cb10-554" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([SMALL <span class="op">?</span> <span class="st">"Prob. of winning House"</span> <span class="op">:</span> <span class="st">"Probability of winning control"</span>]<span class="op">,</span> { </span>
<span id="cb10-555"><a href="#cb10-555" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">min</span>(d_history<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">from_date</span>)<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-556"><a href="#cb10-556" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb10-557"><a href="#cb10-557" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb10-558"><a href="#cb10-558" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb10-559"><a href="#cb10-559" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"TODAY"</span>]<span class="op">,</span> { </span>
<span id="cb10-560"><a href="#cb10-560" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-561"><a href="#cb10-561" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb10-562"><a href="#cb10-562" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb10-563"><a href="#cb10-563" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb10-564"><a href="#cb10-564" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([days_til <span class="op">&gt;</span> <span class="dv">20</span> <span class="op">+</span> SMALL<span class="op">*</span><span class="dv">30</span> <span class="op">?</span> <span class="st">"ELECTION DAY"</span> <span class="op">:</span> <span class="st">""</span>]<span class="op">,</span> { </span>
<span id="cb10-565"><a href="#cb10-565" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> elec_date<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-566"><a href="#cb10-566" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb10-567"><a href="#cb10-567" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb10-568"><a href="#cb10-568" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb10-569"><a href="#cb10-569" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([<span class="fu">fmt_pct</span>(d_sum<span class="op">.</span><span class="at">s_prob</span>)]<span class="op">,</span> { </span>
<span id="cb10-570"><a href="#cb10-570" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">s_prob</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">6</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-571"><a href="#cb10-571" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> </span>
<span id="cb10-572"><a href="#cb10-572" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> BLUE<span class="op">,</span> </span>
<span id="cb10-573"><a href="#cb10-573" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([<span class="fu">fmt_pct</span>(<span class="dv">1</span> <span class="op">-</span> d_sum<span class="op">.</span><span class="at">s_prob</span>)]<span class="op">,</span> { </span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">1</span> <span class="op">-</span> d_sum<span class="op">.</span><span class="at">s_prob</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">6</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> </span>
<span id="cb10-578"><a href="#cb10-578" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> RED<span class="op">,</span></span>
<span id="cb10-579"><a href="#cb10-579" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">stroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb10-581"><a href="#cb10-581" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb10-582"><a href="#cb10-582" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a>        <span class="dt">width</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(w_BODY<span class="op">,</span> width)<span class="op">,</span></span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a>        <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb10-585"><a href="#cb10-585" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb10-586"><a href="#cb10-586" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb10-588"><a href="#cb10-588" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-589"><a href="#cb10-589" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-prob" class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="595" data-source-offset="0"><pre class="sourceCode js"><code class="sourceCode javascript" style="counter-reset: source-line 594;"><span id="cb11-595"><a href="#cb11-595" aria-hidden="true" tabindex="-1"></a>plot_hist_seats <span class="op">=</span> {</span>
<span id="cb11-596"><a href="#cb11-596" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> today <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(d_history<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">from_date</span>)<span class="op">;</span></span>
<span id="cb11-597"><a href="#cb11-597" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> days_til <span class="op">=</span> (elec_date <span class="op">-</span> today) <span class="op">/</span> (<span class="dv">24</span> <span class="op">*</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb11-598"><a href="#cb11-598" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ymin <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(d_history<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s_q10</span>) <span class="op">*</span> <span class="fl">0.9</span><span class="op">;</span></span>
<span id="cb11-599"><a href="#cb11-599" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ymax <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(d_history<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">s_q90</span>) <span class="op">/</span> <span class="fl">0.9</span><span class="op">;</span></span>
<span id="cb11-600"><a href="#cb11-600" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-601"><a href="#cb11-601" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb11-602"><a href="#cb11-602" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb11-603"><a href="#cb11-603" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb11-604"><a href="#cb11-604" aria-hidden="true" tabindex="-1"></a>            <span class="dt">domain</span><span class="op">:</span> [ymin<span class="op">,</span> ymax]<span class="op">,</span></span>
<span id="cb11-605"><a href="#cb11-605" aria-hidden="true" tabindex="-1"></a>            <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-606"><a href="#cb11-606" aria-hidden="true" tabindex="-1"></a>            <span class="dt">axis</span><span class="op">:</span> <span class="st">"right"</span><span class="op">,</span></span>
<span id="cb11-607"><a href="#cb11-607" aria-hidden="true" tabindex="-1"></a>            <span class="dt">ticks</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb11-608"><a href="#cb11-608" aria-hidden="true" tabindex="-1"></a>            <span class="dt">insetTop</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb11-609"><a href="#cb11-609" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb11-610"><a href="#cb11-610" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="kw">null</span>}<span class="op">,</span></span>
<span id="cb11-611"><a href="#cb11-611" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-612"><a href="#cb11-612" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb11-613"><a href="#cb11-613" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_history<span class="op">,</span> {</span>
<span id="cb11-614"><a href="#cb11-614" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span></span>
<span id="cb11-615"><a href="#cb11-615" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">s_q10</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-616"><a href="#cb11-616" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">s_q90</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-617"><a href="#cb11-617" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> BLUE<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb11-618"><a href="#cb11-618" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-619"><a href="#cb11-619" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_history<span class="op">,</span> {</span>
<span id="cb11-620"><a href="#cb11-620" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span></span>
<span id="cb11-621"><a href="#cb11-621" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">s_q25</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-622"><a href="#cb11-622" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">s_q75</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-623"><a href="#cb11-623" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> BLUE<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb11-624"><a href="#cb11-624" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-625"><a href="#cb11-625" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_history<span class="op">,</span> {</span>
<span id="cb11-626"><a href="#cb11-626" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span></span>
<span id="cb11-627"><a href="#cb11-627" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">s_q10</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-628"><a href="#cb11-628" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">s_q90</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-629"><a href="#cb11-629" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> RED<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb11-630"><a href="#cb11-630" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-631"><a href="#cb11-631" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">areaY</span>(d_history<span class="op">,</span> {</span>
<span id="cb11-632"><a href="#cb11-632" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span></span>
<span id="cb11-633"><a href="#cb11-633" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">s_q25</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-634"><a href="#cb11-634" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">s_q75</span><span class="op">,</span> <span class="fl">217.5</span>)<span class="op">,</span></span>
<span id="cb11-635"><a href="#cb11-635" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fill</span><span class="op">:</span> RED<span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb11-636"><a href="#cb11-636" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-637"><a href="#cb11-637" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">line</span>(d_history<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"from_date"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"s_med"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb11-638"><a href="#cb11-638" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-639"><a href="#cb11-639" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="fl">217.5</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#0007"</span>})<span class="op">,</span></span>
<span id="cb11-640"><a href="#cb11-640" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">ruleX</span>([elec_date<span class="op">,</span> today])<span class="op">,</span></span>
<span id="cb11-641"><a href="#cb11-641" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-642"><a href="#cb11-642" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([SMALL <span class="op">?</span> <span class="st">"Forecasted Dem. seats"</span> <span class="op">:</span> <span class="st">"Forecasted Democratic seats won"</span>]<span class="op">,</span> { </span>
<span id="cb11-643"><a href="#cb11-643" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">min</span>(d_history<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">from_date</span>)<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb11-644"><a href="#cb11-644" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb11-645"><a href="#cb11-645" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb11-646"><a href="#cb11-646" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-647"><a href="#cb11-647" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"TODAY"</span>]<span class="op">,</span> { </span>
<span id="cb11-648"><a href="#cb11-648" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb11-649"><a href="#cb11-649" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb11-650"><a href="#cb11-650" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb11-651"><a href="#cb11-651" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-652"><a href="#cb11-652" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([days_til <span class="op">&gt;</span> <span class="dv">20</span> <span class="op">+</span> SMALL<span class="op">*</span><span class="dv">30</span> <span class="op">?</span> <span class="st">"ELECTION DAY"</span> <span class="op">:</span> <span class="st">""</span>]<span class="op">,</span> { </span>
<span id="cb11-653"><a href="#cb11-653" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> elec_date<span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span></span>
<span id="cb11-654"><a href="#cb11-654" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span><span class="op">,</span> <span class="dt">lineAnchor</span><span class="op">:</span> <span class="st">"bottom"</span><span class="op">,</span></span>
<span id="cb11-655"><a href="#cb11-655" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb11-656"><a href="#cb11-656" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-657"><a href="#cb11-657" aria-hidden="true" tabindex="-1"></a>            Plot<span class="op">.</span><span class="fu">text</span>([d_sum<span class="op">.</span><span class="at">s_med</span>]<span class="op">,</span> { </span>
<span id="cb11-658"><a href="#cb11-658" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">x</span><span class="op">:</span> today<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> d_sum<span class="op">.</span><span class="at">s_med</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">6</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb11-659"><a href="#cb11-659" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">frameAnchor</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span> </span>
<span id="cb11-660"><a href="#cb11-660" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"#223"</span><span class="op">,</span></span>
<span id="cb11-661"><a href="#cb11-661" aria-hidden="true" tabindex="-1"></a>                })<span class="op">,</span></span>
<span id="cb11-662"><a href="#cb11-662" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb11-663"><a href="#cb11-663" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-664"><a href="#cb11-664" aria-hidden="true" tabindex="-1"></a>        <span class="dt">width</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(w_BODY<span class="op">,</span> width)<span class="op">,</span></span>
<span id="cb11-665"><a href="#cb11-665" aria-hidden="true" tabindex="-1"></a>        <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb11-666"><a href="#cb11-666" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb11-667"><a href="#cb11-667" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-668"><a href="#cb11-668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb11-669"><a href="#cb11-669" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-670"><a href="#cb11-670" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-671"><a href="#cb11-671" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="plot-hist-seats" class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<hr style="margin: 2em 0">
<p class="text-muted">
<small> A detailed write-up of the model, along with code and data, are available <a href="https://github.com/CoryMcCartan/midterms-22">here</a>. </small>
</p>
<p class="text-muted">
<small> Data are courtesy of FiveThirtyEight, Data for Progress, VEST, the ALARM Project, Daily Kos Elections, the MIT Election Data + Science Lab, and IPUMS. </small>
</p>
<svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1">
<defs> <pattern id="diagonalHatch" width="3" height="3" patterntransform="rotate(45 0 0)" patternunits="userSpaceOnUse"> <line x1="0" y1="0" x2="0" y2="3" style="stroke: #0105; stroke-width: 3;"></line> </pattern> </defs>
</svg>
</section>

</main>
<!-- /main column -->

<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"import { fmt_pct, rate, fmt_surname, AP } from \"./utils.js\"\nd3 = require(\"d3\")\n\nd_sum = FileAttachment(\"summary.json\").json()\ngeom_hex = FileAttachment(\"hex.json\").json()\nd_history = FileAttachment(\"history.csv\").csv({typed: true})\nd_gcb = FileAttachment(\"natl_intent.csv\").csv({typed: true})\nd_hist = FileAttachment(\"seats_hist.csv\").csv({typed: true})\nd_distr_list = {\n    let raw = await FileAttachment(\"districts.csv\").csv({typed: true});\n    return raw.map(d => {\n        d.name = AP[d.state] + \" \" + d.district;\n        d.interval = [d.dem_mean, d.dem_q10, d.dem_q25, d.dem_q75, d.dem_q90];\n        d.rating = rate(d.pr_dem);\n        d.dem_cand = fmt_surname(d.dem_cand);\n        d.rep_cand = fmt_surname(d.rep_cand);\n        d.search = {dem: \"incumbent dem. \", open: \"open seat \", gop: \"incumbent rep. incumbent gop. \"}[d.inc_seat] \n                + [\"contested \", \"unopposed uncontested \"][d.unopp];\n        return d;\n    })\n}\nd_distr = d3.index(d_distr_list, d => d.state, d => d.district)\n\nDARK_BLUE = \"#0063B1\"\nDARK_RED = \"#A0442C\"\nBLUE = \"#3D77BB\"\nRED = \"#B25D4C\"\nw_BODY = 796;\nSMALL = width < 600;\nelec_date = new Date(\"2022-11-08\")\n\ncolor = {\n    let midpt = \"#fafffa\";\n    let color_dem = d3.scaleLinear()\n        .domain([0.5, 1.0])\n        .range([midpt, DARK_BLUE]);\n    let color_gop = d3.scaleLinear()\n        .domain([0.0, 0.5])\n        .range([DARK_RED, midpt]);\n    return x => x <= 0.5 ? color_gop(x) : color_dem(x);\n}\n\nwindow.Plot = Plot;\nwindow.d3 = d3;\nwindow.d_distr_list = d_distr_list;\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"{\nlet exag_fac = 1 - Math.sqrt(width)/80;\nlet last_elec = 222;\nlet xmin = Math.max(Math.min(d_sum.s_q10*exag_fac, 218 - 10), 0)\nlet xmax = Math.min(Math.max(d_sum.s_q90/exag_fac, 218 + 10), 435)\nlet s_gain = \"+\" + Math.abs(222 - Math.round(d_sum.s_med));\nlet overl = Math.max(0.58, 1 - Math.sqrt(width) / 80);\n\nlet text_shadow = function(text, opt) {\n    let opt2 = {...opt}\n    opt2.dx = opt2.dx + 3\n    opt2.dy = opt2.dy + 3\n    opt2.fill = \"#0007\"\n    return [Plot.text([text], opt2), Plot.text([text], opt)]\n}\n\nwindow.plot = Plot.plot({\n    x: {\n        domain: [xmin, xmax],\n        clamp: true,\n        inset: 10,\n        tickSize: 8,\n        reverse: true,\n    },\n    y: {\n        legend: false,\n        axis: null,\n        insetTop: 4,\n    },\n    color: {\n        legend: false,\n    },\n    marks: [\n        Plot.rectY(d_hist, {\n                x1: d => d.dem_seats - overl,\n                x2: d => d.dem_seats + overl,\n                y: \"pr\",\n                fill: d => d.dem_seats >= 218 ? BLUE : RED,\n            }),\n        Plot.ruleY([0]),\n        Plot.ruleY([0], {\n            dy: 2,\n            strokeWidth: 5,\n            x1: d_sum.s_q10,\n            x2: d_sum.s_q90,\n            color: \"red\",\n            }),\n        Plot.ruleX([222, d_sum.s_med]),\n        text_shadow(s_gain, { \n            x: d_sum.s_med, dy: -48, dx: 3,\n            frameAnchor: \"bottom\", textAnchor: \"start\", lineAnchor: \"bottom\",\n            fill: \"white\", fontSize: 40, fontWeight: \"bold\",\n            }),\n        text_shadow(\"GAIN\", { \n            x: d_sum.s_med, dy: -42, dx: 5,\n            frameAnchor: \"bottom\", textAnchor: \"start\", lineAnchor: \"top\",\n            fill: \"white\", fontSize: 14, fontWeight: \"bold\",\n            }),\n        Plot.text([\"← DEM. MAJORITY\"], { \n            x: 217.5, dy: -4, dx: -3,\n            frameAnchor: \"bottom\", textAnchor: \"end\",\n            fontWeight: \"bold\", fill: \"#111\",\n            }),\n        Plot.text([\"REP. MAJORITY →\"], { \n            x: 217.5, dy: -4, dx: 3,\n            frameAnchor: \"bottom\", textAnchor: \"start\",\n            fontWeight: \"bold\", fill: \"#111\",\n            }),\n         Plot.text([last_elec + \" LAST ELECTION\"], { \n            x: last_elec, dy: -4,\n            frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n            fontWeight: \"bold\",\n            }),\n         Plot.text([\"← DEM. SEATS\"], { \n            x: xmax, dy: -4 - (SMALL ? 10 : 0), dx: 4,\n            frameAnchor: \"bottom\", textAnchor: \"start\",\n            fontWeight: \"bold\",\n            }),\n    ],\n    \n    width: width,\n    height: 240,\n    marginBottom: 0,\n    marginLeft: 0,\n    marginRight: 0,\n    \n    style: {\n        fontSize: 9,\n        color: \"#444\",\n        overflow: \"visible\",\n    }\n})\nreturn window.plot;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"\ndem_lead = d_sum.s_prob > 0.5\n{\n    let win_party = dem_lead ? \"Democrats\" : \"Republicans\"\n    let win_class = dem_lead ? \"dem\" : \"rep\"\n    let min_seats = dem_lead ? d_sum.s_q10 : 435 - d_sum.s_q90\n    let max_seats = dem_lead ? d_sum.s_q90 : 435 - d_sum.s_q10\n    let phrase = dem_lead ? \"maintaining\" : \"flipping\"\n    let prob = dem_lead ? d_sum.s_prob : 1 - d_sum.s_prob\n    let timestamp = d_history[d_history.length-1].timestamp;\n    let date_fmt = timestamp.toLocaleString(\"en-US\", { \n            weekday: \"long\", \n            month: \"long\", \n            day: \"numeric\", \n            hour: \"numeric\", \n            minute: \"numeric\",\n            timeZoneName: \"short\",\n            })       \n\n    return md`\nThe <b class=\"${win_class}\">${win_party}</b> are expected to win\n**between ${min_seats} and ${max_seats} seats**.\n\nThey have a **${fmt_pct(prob)} chance** of ${phrase} the House.\n\n<p class=\"updated\">Last updated ${date_fmt}.</p>`;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"{\nlet distrs = topojson.feature(geom_hex, geom_hex.objects.foo).features.map(d => {\n    d.match = d_distr.get(d.properties.state).get(d.properties.district);\n    d.flip = ((d.match.pr_dem > 0.5 && d.match.inc_seat == \"gop\") \n                || (d.match.pr_dem < 0.5 && d.match.inc_seat == \"dem\"))\n            && (Math.abs(d.match.pr_dem - 0.5) > 0.1);\n    return d;\n})\n    \nconst w = 960;\nconst h = w * 0.72;\nconst GOLD = \"#bc1\";\n\nconst svg = d3\n    .create(\"svg\")\n    .attr(\"viewBox\", [0, 0, w, h])\n    .style(\"width\", \"100%\")\n    .style(\"height\", \"auto\");\n\nlet proj = d3.geoAlbers()\n    .scale(0.9*w)\n    .translate([0.98*w/2, 0.91*h/2]);\nlet path = d3.geoPath(proj);\n\nlet geom_distrs = svg\n    .append(\"g\")\n    .attr(\"class\", \"distrs\")\n    .selectAll(\"path\")\n    .data(distrs)\n    .enter().append(\"path\")\n    .attr(\"fill\", d => color(d.match.pr_dem))\n    .attr(\"stroke\", \"#111\")\n    .attr(\"stroke-width\", 0.5)\n    .attr(\"d\", path);\n\nlet geom_distrs_hover = svg\n    .append(\"g\")\n    .attr(\"class\", \"distrs\")\n    .selectAll(\"path\")\n    .data(distrs)\n    .enter().append(\"path\")\n    .attr(\"fill\", d => d.flip ? \"url(#diagonalHatch)\" : \"none\")\n    .attr(\"stroke\", \"#000\")\n    .attr(\"stroke-width\", 0.0)\n    .attr(\"d\", path);    \n\nlet tt = d3.select(\"#plot-map\").append(\"div\")\n        .attr(\"class\", \"map-tooltip\")\n        .style(\"visibility\", \"hidden\");\n    \nlet mmv = function(e, d) {\n    let [mx, my] = d3.pointer(e);\n    if (mx < 60) mx = 60;\n    if (mx > w - 160) mx = w - 160;\n    \n    let prob = d.match.pr_dem;\n    let cand;\n    if (prob > 0.5) {\n        cand = d.match.dem_cand == \"NA\" ? \"The Democrat\" : d.match.dem_cand;\n    } else {\n        cand = d.match.rep_cand == \"NA\" ? \"The Republican\" : d.match.rep_cand;\n    }\n    let inc = {\n        dem: `<b style='color: ${DARK_BLUE}'>Dem.</b> incumbent`,\n        gop: `<b style='color: ${DARK_RED}'>Rep.</b> incumbent`,\n        open: \"<b>Open</b> seat\",\n    }[d.match.inc_seat]\n    let prob_text;\n    let prob_color = prob > 0.5 ? DARK_BLUE : DARK_RED;\n    if (d.match.unopp == 1) {\n        prob_text = `<b style=\"color: ${prob_color}\">${cand}</b>\n            is running unopposed and will win the seat.`\n    } else {\n        prob_text = `<b style=\"color: ${prob_color}\">${cand}</b> \n            has a <b>${fmt_pct(prob > 0.5 ? prob : 1 - prob)}</b> chance of winning.`\n    }\n    \n    d3.select(this).attr(\"stroke-width\", 2.4);\n    \n    let txt = `<h3>${d.match.name}</h3>\n        <p>${inc}</p>\n        <div style=\"width: 100%; height: 1rem; margin: 4px 0; display: flex;\">\n        <div style=\"background: ${BLUE}; flex-basis: ${100*prob}%\"></div>\n        <div style=\"background: ${RED}; flex-basis: ${100 - 100*prob}%\"></div>\n        </div>\n        <p>${prob_text}</p>\n        `;\n        \n    let svg_dim = svg.node().getBoundingClientRect();\n\n    tt.style(\"visibility\", \"visible\")\n      .html(txt)\n      .style(\"left\", (mx - 50)*svg_dim.width/w + \"px\")\n      .style(\"bottom\", (h - my + 25)*svg_dim.height/h + \"px\");\n}\nlet mout = function(d) {\n    geom_distrs_hover.attr(\"stroke-width\", 0.0);\n    tt.style(\"visibility\", \"hidden\");\n}\n\ngeom_distrs_hover.on(\"mousemove\", mmv);\ngeom_distrs_hover.on(\"touchmove\", mmv);\nsvg.on(\"mouseout\", mout);\nsvg.on(\"touchend\", mout);\n\nreturn svg.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"plot_gcb = {\n    const ci_w = d_sum.i_q90 - d_sum.i_q10\n    const ymin = Math.max(Math.min(d_sum.i_med - 1*ci_w, 0.45), 0)\n    const ymax = Math.min(Math.max(d_sum.i_med + 1*ci_w, 0.52), 1)\n    const today = Math.min(elec_date, Date.now());\n    const days_til = (elec_date - today) / (24 * 3600 * 1000);\n    \n    return Plot.plot({\n        y: {\n            label: null,\n            domain: [ymin, ymax],\n            grid: true,\n            tickFormat: \"%\",\n            axis: \"right\",\n            ticks: 5,\n        },\n        x: {label: null},\n        \n        marks: [\n            Plot.areaY(d_gcb, {\n                    x: \"date\",\n                    y1: d => Math.max(d.q10, 0.5),\n                    y2: d => Math.max(d.q90, 0.5),\n                    fill: BLUE, opacity: 0.4,\n                }),\n            Plot.areaY(d_gcb, {\n                    x: \"date\",\n                    y1: d => Math.max(d.q25, 0.5),\n                    y2: d => Math.max(d.q75, 0.5),\n                    fill: BLUE, opacity: 0.4,\n                }),\n            Plot.areaY(d_gcb, {\n                    x: \"date\",\n                    y1: d => Math.min(d.q10, 0.5),\n                    y2: d => Math.min(d.q90, 0.5),\n                    fill: RED, opacity: 0.4,\n                }),\n            Plot.areaY(d_gcb, {\n                    x: \"date\",\n                    y1: d => Math.min(d.q25, 0.5),\n                    y2: d => Math.min(d.q75, 0.5),\n                    fill: RED, opacity: 0.4,\n                }),\n            Plot.line(d_gcb.filter(d => d.date <= today), \n                    {x: \"date\", y: \"natl_dem\", strokeWidth: 3}),\n            Plot.line(d_gcb.filter(d => d.date >= today), \n                    {x: \"date\", y: \"natl_dem\", strokeWidth: 3, \n                    strokeDasharray: \"4,3\", strokeLinecap: \"butt\" }),\n            \n            Plot.ruleY([0.5], {stroke: \"#0007\"}),\n            Plot.rect([0], {\n                    x1: today, x2: elec_date, y1: ymin, y2: ymax,\n                    fill: \"#fff7\",\n                }),\n            Plot.ruleX([elec_date, today]),\n            \n            Plot.text([SMALL ? \"Estimated Dem. vote\" : \"Estimated Democratic two-party vote\"], { \n                    x: d3.min(d_gcb, d => d.date), dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"start\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\", fontSize: 15,\n                }),\n            Plot.text([\"TODAY\"], { \n                    x: today, dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\",\n                }),\n            Plot.text([days_til > 20 + SMALL*30 ? \"ELECTION DAY\" : \"\"], { \n                    x: elec_date, dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\",\n                }),\n            Plot.text([fmt_pct(d_sum.i_med, 1)], { \n                    x: elec_date, y: d_sum.i_med, dy: -6, dx: -4,\n                    frameAnchor: \"top\", textAnchor: \"end\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\", fontSize: 15, fill: \"#223\",\n                }),\n        ],\n        \n        width: Math.min(w_BODY, width),\n        height: 300,\n        marginRight: 40,\n        \n        style: {\n        }\n    })\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"viewof search = Inputs.search(d_distr_list, {\n    label: \"Districts:\",\n    columns: [\"name\", \"state\", \"inc_seat\", \"search\", \"rating\", \"dem_cand\", \"rep_cand\"],\n    autocomplete: false,\n    width: Math.min(width - 8, w_BODY),\n})\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"tab_distr = {\n    window.search = search;\n    let fmt_inc = function(x) {\n        return html`<span style=\"color: ${{dem: DARK_BLUE, gop: DARK_RED, open: \"black\"}[x]}\">\n            ${{dem: \"Dem.\", gop: \"Rep.\", open: \"Open\"}[x]}\n            </span>`\n    }\n    let fmt_part = function(x) {\n        if (x == \"NA\") {\n            return html`<span style=\"color: #777\">&ndash;</span>`\n        } else {\n            let color = x > 0.5 ? DARK_BLUE : DARK_RED;\n            return html`<span style=\"color: ${color}\">${fmt_pct(x, 1)}</span>`\n        }\n    }\n    let fmt_prob = function(x) {\n        let tcolor = Math.abs(x - 0.5) > 0.3 ? \"#fffc\" : \"black\";\n        return html`<div class=\"chip\" style=\"background: ${color(x)}; color: ${tcolor}\">\n            ${fmt_pct(x)}</div>`\n    }\n    \n    let xmin = d3.min(d_distr_list, d => d.dem_q10)\n    let xmax = d3.max(d_distr_list, d => d.dem_q90)\n    let avg = 50*(xmin + xmax);\n    let x = d3.scaleLinear().domain([xmax, xmin]).range([0, 100]);\n    let x_dem = d3.scaleLinear().domain([xmax, 0.5]).range([0, avg]).clamp(true);\n    let x_rep = d3.scaleLinear().domain([0.5, xmin]).range([avg, 100]).clamp(true);\n    let ici_d = BLUE + \"bb\";\n    let oci_d = BLUE + \"77\";\n    let ici_r = RED + \"cc\";\n    let oci_r = RED + \"88\";\n    let fmt_vs = function(int) {\n        if (int[0] == \"NA\") {\n            return html`<div style=\"text-align: center; color: #777\">(Unopposed)</div>`\n        } else {\n            let gr = `linear-gradient(90deg, transparent 0%,\n               transparent ${x_dem(int[4])}%, ${oci_d} ${x_dem(int[4])}%, \n               ${oci_d} ${x_dem(int[3])}%, ${ici_d} ${x_dem(int[3])}%,\n               ${ici_d} ${x_dem(int[2])}%, ${oci_d} ${x_dem(int[2])}%,\n               ${oci_d} ${x_dem(int[1])}%, transparent ${x_dem(int[1])}%,\n               transparent ${x_rep(int[4])}%,  ${oci_r} ${x_rep(int[4])}%, \n               ${oci_r} ${x_rep(int[3])}%, ${ici_r} ${x_rep(int[3])}%,\n               ${ici_r} ${x_rep(int[2])}%, ${oci_r} ${x_rep(int[2])}%,\n               ${oci_r} ${x_rep(int[1])}%, transparent ${x_rep(int[1])}%,\n               transparent 100%)`;\n            return html`\n                <div class=\"est\" style=\"background: ${gr}; \n                    padding-left: calc(${x(int[0])}% - 6px);\">\n                &#x25cf;&nbsp;${fmt_pct(int[0])}</div>\n                `;\n        }\n    }\n    let fmt_vs_tiny = function(int) {\n        if (int[0] == \"NA\") {\n            return html`<span style=\"color: #777\">(Unopp.)</span>`\n        } else {\n            let color = int[0] > 0.5 ? DARK_BLUE : DARK_RED;\n            return html`<span style=\"color: ${color};\">${fmt_pct(int[0], 1)}</span>`;\n        }\n    }\n    \n    let cols = [\"name\", \"inc_seat\", \"pr_dem\", \"interval\", \"part_base\", ];\n    let cols_small = [\"name\", \"inc_seat\", \"pr_dem\", \"interval\", ];\n    const tiny = width < 460;\n    \n    return Inputs.table(search, {\n        columns: SMALL ? cols_small : cols,\n        \n        header: {\n            name: \"District\",\n            inc_seat: tiny ? \"Inc.\" : \"Incumbent\",\n            pr_dem: \"Win prob.\",\n            interval: tiny ? \"Est. vote\" : \"Vote forecast\",\n            part_base: \"2020 pres.\",\n        },\n        \n        format: {\n            inc_seat: fmt_inc,\n            pr_dem: fmt_prob,\n            interval: tiny ? fmt_vs_tiny : fmt_vs,\n            part_base: fmt_part,\n        },\n        \n        width: {\n            interval: 400,\n        },\n        maxWidth: w_BODY,\n        \n        rows: 30,\n        layout: \"fixed\",\n    })\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"plot_prob = {\n    const today = d3.max(d_history, d => d.from_date);\n    const days_til = (elec_date - today) / (24 * 3600 * 1000);\n    \n    return Plot.plot({\n        y: {\n            label: null,\n            domain: [0, 1],\n            grid: true,\n            tickFormat: \"%\",\n            axis: \"right\",\n            ticks: [0, 0.25, 0.5, 0.75, 1],\n            insetTop: 4,\n        },\n        x: {label: null},\n        \n        marks: [\n            Plot.line(d_history, {x: \"from_date\", y: \"s_prob\", strokeWidth: 3, stroke: BLUE}),\n            Plot.line(d_history, {x: \"from_date\", y: d => 1 - d.s_prob, strokeWidth: 3, stroke: RED}),\n            \n            Plot.ruleY([0.5], {stroke: \"#0007\"}),\n            Plot.ruleX([elec_date, today]),\n            \n            Plot.text([SMALL ? \"Prob. of winning House\" : \"Probability of winning control\"], { \n                    x: d3.min(d_history, d => d.from_date), dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"start\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\", fontSize: 15,\n                }),\n            Plot.text([\"TODAY\"], { \n                    x: today, dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\",\n                }),\n            Plot.text([days_til > 20 + SMALL*30 ? \"ELECTION DAY\" : \"\"], { \n                    x: elec_date, dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\",\n                }),\n            Plot.text([fmt_pct(d_sum.s_prob)], { \n                    x: today, y: d_sum.s_prob, dy: -6, dx: 4,\n                    frameAnchor: \"top\", textAnchor: \"start\", \n                    fontWeight: \"bold\", fontSize: 15, fill: BLUE, \n                    stroke: \"white\", strokeWidth: 4,\n                }),\n            Plot.text([fmt_pct(1 - d_sum.s_prob)], { \n                    x: today, y: 1 - d_sum.s_prob, dy: -6, dx: 4,\n                    frameAnchor: \"top\", textAnchor: \"start\", \n                    fontWeight: \"bold\", fontSize: 15, fill: RED,\n                    stroke: \"white\", strokeWidth: 4,\n                }),\n        ],\n        \n        width: Math.min(w_BODY, width),\n        height: 300,\n        marginRight: 40,\n        \n        style: {\n        }\n    })\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"plot_hist_seats = {\n    const today = d3.max(d_history, d => d.from_date);\n    const days_til = (elec_date - today) / (24 * 3600 * 1000);\n    const ymin = d3.min(d_history, d => d.s_q10) * 0.9;\n    const ymax = d3.max(d_history, d => d.s_q90) / 0.9;\n    \n    return Plot.plot({\n        y: {\n            label: null,\n            domain: [ymin, ymax],\n            grid: true,\n            axis: \"right\",\n            ticks: 5,\n            insetTop: 4,\n        },\n        x: {label: null},\n        \n        marks: [\n            Plot.areaY(d_history, {\n                    x: \"from_date\",\n                    y1: d => Math.max(d.s_q10, 217.5),\n                    y2: d => Math.max(d.s_q90, 217.5),\n                    fill: BLUE, opacity: 0.4,\n                }),\n            Plot.areaY(d_history, {\n                    x: \"from_date\",\n                    y1: d => Math.max(d.s_q25, 217.5),\n                    y2: d => Math.max(d.s_q75, 217.5),\n                    fill: BLUE, opacity: 0.4,\n                }),\n            Plot.areaY(d_history, {\n                    x: \"from_date\",\n                    y1: d => Math.min(d.s_q10, 217.5),\n                    y2: d => Math.min(d.s_q90, 217.5),\n                    fill: RED, opacity: 0.4,\n                }),\n            Plot.areaY(d_history, {\n                    x: \"from_date\",\n                    y1: d => Math.min(d.s_q25, 217.5),\n                    y2: d => Math.min(d.s_q75, 217.5),\n                    fill: RED, opacity: 0.4,\n                }),\n            Plot.line(d_history, {x: \"from_date\", y: \"s_med\", strokeWidth: 3}),\n            \n            Plot.ruleY([217.5], {stroke: \"#0007\"}),\n            Plot.ruleX([elec_date, today]),\n            \n            Plot.text([SMALL ? \"Forecasted Dem. seats\" : \"Forecasted Democratic seats won\"], { \n                    x: d3.min(d_history, d => d.from_date), dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"start\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\", fontSize: 15,\n                }),\n            Plot.text([\"TODAY\"], { \n                    x: today, dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\",\n                }),\n            Plot.text([days_til > 20 + SMALL*30 ? \"ELECTION DAY\" : \"\"], { \n                    x: elec_date, dy: -4,\n                    frameAnchor: \"top\", textAnchor: \"middle\", lineAnchor: \"bottom\",\n                    fontWeight: \"bold\",\n                }),\n            Plot.text([d_sum.s_med], { \n                    x: today, y: d_sum.s_med, dy: -6, dx: 4,\n                    frameAnchor: \"top\", textAnchor: \"start\", \n                    fontWeight: \"bold\", fontSize: 15, fill: \"#223\",\n                }),\n        ],\n        \n        width: Math.min(w_BODY, width),\n        height: 300,\n        marginRight: 40,\n        \n        style: {\n        }\n    })\n}\n"},{"methodName":"interpretQuiet","source":"shinyInput('search')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
</div> <!-- /content -->



</body></html>